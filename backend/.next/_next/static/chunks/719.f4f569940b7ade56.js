"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[719],{2452:(e,t,a)=>{function s(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3000":"https://beenycool-github-io.onrender.com"}a.d(t,{AW:()=>i,sC:()=>r,xT:()=>n});let r=()=>window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname,n=e=>{let t=s();return e.startsWith("/api/")||e.startsWith("api/")?e.startsWith("/api/")&&(e=e.substring(1)):e="api/"+e,r()&&e.startsWith("api/")&&(e=e.substring(4)),"".concat(t,"/").concat(e)},i=()=>{try{if(window.aV=window.aV||{},window.API_HELPERS=window.API_HELPERS||{},window.BACKEND_STATUS=window.BACKEND_STATUS||{status:"checking"},window.constructApiUrl=n,window.isGitHubPages=r,window.API_BASE_URL=s(),r()){try{window.localStorage.setItem("USE_LOCAL_API","true")}catch(e){console.warn("Could not set localStorage item:",e)}window.BACKEND_STATUS={status:"online",lastChecked:new Date().toLocaleTimeString(),isGitHubPages:!0,usingRemoteAPI:!0},console.log("GitHub Pages mode activated - API calls will be redirected to backend")}return console.log("Using API URL: ".concat(s(),", GitHub Pages: ").concat(r())),!0}catch(e){console.error("Error initializing API helpers:",e);try{return window.aV=window.aV||{},window.API_HELPERS=window.API_HELPERS||{},"function"!=typeof window.constructApiUrl&&(window.constructApiUrl=e=>(e.startsWith("/")||e.startsWith("api/")?e.startsWith("/api/")&&(e=e.substring(1)):e="api/"+e,"".concat("https://beenycool-github-io.onrender.com","/").concat(e))),r()&&(!window.BACKEND_STATUS||"online"!==window.BACKEND_STATUS.status)&&(window.BACKEND_STATUS={status:"online",lastChecked:new Date().toLocaleTimeString(),isGitHubPages:!0,usingFallbacks:!0}),console.log("API helpers fallbacks initialized"),!0}catch(e){console.error("Failed to initialize API helpers fallback:",e),window.aV=window.aV||{},window.API_HELPERS=window.API_HELPERS||{}}return!1}}},34964:(e,t,a)=>{a.d(t,{Xi:()=>c,av:()=>d,j7:()=>o,tU:()=>l});var s=a(95155),r=a(12115),n=a(60704),i=a(19433);let l=n.bL,o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.B8,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});o.displayName=n.B8.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.l9,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});c.displayName=n.l9.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.UC,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});d.displayName=n.UC.displayName},53719:(e,t,a)=>{a.r(t),a.d(t,{default:()=>e0});var s=a(95155),r=a(12115),n=a(1978),i=a(60760),l=a(33239);a(31491);var o=a(37772),c=a(29581),d=a(19433),m=a(97168),u=a(99474),h=a(88482),x=a(95784),g=a(43453),p=a(1243),f=a(53904),b=a(71539),j=a(51154),w=a(66516),v=a(94788),k=a(54416),y=a(13052),N=a(82178),S=a(55133),A=a(29869),C=a(47863),R=a(66474),E=a(50773),T=a(33786);let I=(0,a(74466).F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function P(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,d.cn)(I({variant:a}),t),...r})}function F(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,d.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function M(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,d.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}var O=a(34964),q=a(37777),_=a(88145),B=a(54052),U=a.n(B),G=a(38637),D=a.n(G),z=a(15452);let W=z.bL;z.l9;let $=e=>{let{children:t,...a}=e;return(0,s.jsx)(z.ZL,{...a,children:(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-center sm:items-center",children:t})})};$.displayName=z.ZL.displayName;let J=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(z.hJ,{ref:t,className:(0,d.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in",a),...r})});J.displayName=z.hJ.displayName;let L=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)($,{children:[(0,s.jsx)(J,{}),(0,s.jsxs)(z.UC,{ref:t,className:(0,d.cn)("fixed z-50 grid w-full gap-4 rounded-b-lg border bg-background p-6 shadow-lg animate-in data-[state=open]:fade-in-90 data-[state=open]:slide-in-from-bottom-10 sm:max-w-lg sm:rounded-lg sm:zoom-in-90 data-[state=open]:sm:slide-in-from-bottom-0",a),...n,children:[r,(0,s.jsxs)(z.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(k.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});L.displayName=z.UC.displayName;let H=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};H.displayName="DialogHeader";let V=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};V.displayName="DialogFooter";let K=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(z.hE,{ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});K.displayName=z.hE.displayName;let Q=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(z.VY,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",a),...r})});function Y(e){let{open:t,onOpenChange:a}=e;return(0,s.jsx)(W,{open:t,onOpenChange:a,children:(0,s.jsxs)(L,{className:"sm:max-w-md",children:[(0,s.jsxs)(H,{children:[(0,s.jsxs)(K,{className:"flex items-center gap-2",children:[(0,s.jsx)(S.A,{className:"h-5 w-5"}),"Keyboard Shortcuts"]}),(0,s.jsx)(Q,{children:"Use these keyboard shortcuts to quickly navigate and use the application."})]}),(0,s.jsx)("div",{className:"py-4",children:(0,s.jsx)("div",{className:"space-y-2",children:[{keys:["Ctrl","Enter"],description:"Submit for marking"},{keys:["Ctrl","Shift","R"],description:"Reset form"},{keys:["Ctrl","."],description:"Toggle advanced options"},{keys:["Ctrl","/"],description:"Toggle help guide"},{keys:["Ctrl","K"],description:"Open shortcuts dialog"},{keys:["Tab"],description:"Navigate between fields"},{keys:["Esc"],description:"Close dialogs"}].map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center py-1 border-b border-gray-100 dark:border-gray-800",children:[(0,s.jsx)("span",{className:"text-sm",children:e.description}),(0,s.jsx)("div",{className:"flex items-center gap-1",children:e.keys.map((t,a)=>(0,s.jsxs)("span",{children:[(0,s.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded text-xs",children:t}),a<e.keys.length-1&&(0,s.jsx)("span",{className:"mx-1 text-gray-400",children:"+"})]},a))})]},t))})}),(0,s.jsx)(V,{children:(0,s.jsx)(m.$,{onClick:()=>a(!1),children:"Close"})})]})})}Q.displayName=z.VY.displayName,Y.propTypes={open:D().bool.isRequired,onOpenChange:D().func.isRequired};var Z=a(24357),X=a(28883),ee=a(18175),et=a(10488),ea=a(91788),es=a(81304),er=a(48698),en=a(5196),ei=a(9428);let el=er.bL,eo=er.l9;er.YJ,er.ZL,er.Pb,er.z6,r.forwardRef((e,t)=>{let{className:a,inset:r,children:n,...i}=e;return(0,s.jsxs)(er.ZP,{ref:t,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",a),...i,children:[n,(0,s.jsx)(y.A,{className:"ml-auto h-4 w-4"})]})}).displayName=er.ZP.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(er.G5,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground dark:bg-popover dark:text-popover-foreground p-1 shadow-md animate-in slide-in-from-left-1",a),...r})}).displayName=er.G5.displayName;let ec=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(er.ZL,{children:(0,s.jsx)(er.UC,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground dark:bg-popover dark:text-popover-foreground p-1 shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});ec.displayName=er.UC.displayName;let ed=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(er.q7,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",a),...n})});ed.displayName=er.q7.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...i}=e;return(0,s.jsxs)(er.H_,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(er.VF,{children:(0,s.jsx)(en.A,{className:"h-4 w-4"})})}),r]})}).displayName=er.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(er.hN,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(er.VF,{children:(0,s.jsx)(ei.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=er.hN.displayName;let em=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(er.JU,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})});em.displayName=er.JU.displayName;let eu=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(er.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});eu.displayName=er.wv.displayName;var eh=a(82714),ex=a(89852),eg=a(86653),ep=a(27971),ef=a(56671),eb=a(42337);a(8310);var ej=a(16891),ew=a(54073);function ev(e){let{className:t,defaultValue:a,value:n,min:i=0,max:l=100,...o}=e,c=r.useMemo(()=>Array.isArray(n)?n:Array.isArray(a)?a:[i,l],[n,a,i,l]);return(0,s.jsxs)(ew.bL,{"data-slot":"slider",defaultValue:a,value:n,min:i,max:l,className:(0,d.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...o,children:[(0,s.jsx)(ew.CC,{"data-slot":"slider-track",className:(0,d.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,s.jsx)(ew.Q6,{"data-slot":"slider-range",className:(0,d.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:c.length},(e,t)=>(0,s.jsx)(ew.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}var ek=a(4884);function ey(e){let{className:t,...a}=e;return(0,s.jsx)(ek.bL,{"data-slot":"switch",className:(0,d.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(ek.zi,{"data-slot":"switch-thumb",className:(0,d.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}var eN=a(60408),eS=a.n(eN),eA=a(2452);let eC="https://beenycool-github-io.onrender.com",eR=(0,eA.sC)(),eE=[{value:"english",label:"English"},{value:"maths",label:"Maths",hasTiers:!0},{value:"science",label:"Science",hasTiers:!0},{value:"history",label:"History"},{value:"geography",label:"Geography"},{value:"computerScience",label:"Computer Science"},{value:"businessStudies",label:"Business Studies"}],eT=[{value:"aqa",label:"AQA"},{value:"edexcel",label:"Edexcel"},{value:"ocr",label:"OCR"},{value:"wjec",label:"WJEC"}],eI=[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"}],eP=[{value:"o3",label:"O3",description:"Most powerful model, but heavily rate limited."},{value:"o4-mini",label:"O4 Mini",description:"Delivers compareable performance to o3, but much faster"},{value:"xai/grok-3",label:"Grok-3",description:"X AI Model (Grok)"},{value:"xai/grok-3-mini",label:"Grok-3 Mini",description:"Smaller, faster X AI Model"},{value:"gemini-2.5-flash-preview-05-20",label:"Gemini 2.5 Flash Preview",description:"Best quality with faster response times"},{value:"microsoft/mai-ds-r1:free",label:"R1 (thinking model)",description:"Most thorough reasoning process (may take 1-2 minutes)"},{value:"deepseek/deepseek-chat-v3-0324:free",label:"V3 (balanced model)",description:"Balanced speed and quality"},{value:"google/gemini-2.0-flash-exp:free",label:"Gemini 2.0 Flash (OCR only)",description:"Special model for OCR with exam board OCR"}],eF={"gemini-2.5-flash-preview-05-20":"deepseek/deepseek-chat-v3-0324:free","deepseek/deepseek-chat-v3-0324:free":"microsoft/mai-ds-r1:free","microsoft/mai-ds-r1:free":"gemini-2.5-flash-preview-05-20",o3:"o4-mini","o4-mini":"deepseek/deepseek-chat-v3-0324:free","xai/grok-3":"deepseek/deepseek-chat-v3-0324:free","google/gemini-2.0-flash-exp:free":"deepseek/deepseek-chat-v3-0324:free"},eM={"gemini-2.5-flash-preview-05-20":6e4,"deepseek/deepseek-chat-v3-0324:free":1e4,"microsoft/mai-ds-r1:free":6e4,"openrouter/masr1":3e4,o3:6e4,"o4-mini":3e4,o4:6e4,"xai/grok-3":6e4,"google/gemini-2.0-flash-exp:free":6e4},eO={image_processing:{default:"gemini-2.5-flash-preview-05-20",ocr:"google/gemini-2.0-flash-exp:free"},subject_assessment:"gemini-2.5-flash-preview-05-20"},eq={"gemini-2.5-flash-preview-05-20":1024,"microsoft/mai-ds-r1:free":0,o3:4e3,"o4-mini":4e3,"xai/grok-3":2048,"google/gemini-2.0-flash-exp:free":1024},e_={english:["shakespeare","poem","poetry","novel","character","theme","literature"],maths:["equation","solve","calculate","algebra","geometry","trigonometry","formula"],science:["experiment","hypothesis","cell","atom","energy","physics","chemistry","biology"],history:["war","battle","king","queen","century","revolution","empire","historical"],geography:["map","climate","population","country","city","river","mountain","ecosystem"],computerScience:["programming","algorithm","code","computer","software","hardware"],businessStudies:["business","market","finance","profit","enterprise","economy"]},eB={english:{aqa:[{value:"general",label:"General Assessment"},{value:"paper1q3",label:"Paper 1, Question 3 (Structure)"},{value:"paper1q4",label:"Paper 1, Question 4 (Evaluation)"},{value:"paper2q2",label:"Paper 2, Question 2 (Summary)"},{value:"paper2q5",label:"Paper 2, Question 5 (Writing)"}],edexcel:[{value:"general",label:"General Assessment"}],ocr:[{value:"general",label:"General Assessment"}],wjec:[{value:"general",label:"General Assessment"}]}},eU=e=>{if(!e)return null;for(let t of[/\[(\d+) marks?\]/i,/\((\d+) marks?\)/i,/worth (\d+) marks?/i,/for (\d+) marks?/i,/total (?:of )?(\d+) marks?/i,/\[Total:? (\d+)(?:\s*marks?)?\]/i,/\(Total:? (\d+)(?:\s*marks?)?\)/i,/^(\d+) marks?:?/i,/\[(\d+)(?:\s*m)\]/i,/\((\d+)(?:\s*m)\)/i]){let a=e.match(t);if(a&&a[1]){let e=parseInt(a[1]);if(!isNaN(e)&&e>0)return console.log("Detected ".concat(e," total marks from question")),void 0!==ef.oR&&ef.oR.info("Automatically detected ".concat(e," total marks from the question")),e.toString()}}return null},eG=e=>{var t,a,r,n,i;let{success:l,error:o,onRetryAction:c}=e;if(!l&&!o)return null;if(l)return(0,s.jsxs)(P,{className:"mb-4 bg-green-50 dark:bg-green-950 border-green-200 dark:border-green-900",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,s.jsx)(F,{className:"text-green-800 dark:text-green-300 ml-2",children:"Success"}),(0,s.jsx)(M,{className:"text-green-700 dark:text-green-400 ml-2",children:l.message})]});let d="api_error"===o.type||(null==(t=o.message)?void 0:t.includes("API"))||(null==(a=o.message)?void 0:a.includes("backend")),u=(null==(r=o.type)?void 0:r.startsWith("rate_limit"))||(null==(n=o.message)?void 0:n.includes("rate limit"))||(null==(i=o.message)?void 0:i.toLowerCase().includes("too many requests")),h="Error";return d?h="API Error":"rate_limit_with_fallback"===o.type?h="Rate Limited (Fallback Available)":"rate_limit_wait"===o.type?h="Rate Limited (Please Wait)":u&&(h="Rate Limited"),(0,s.jsxs)(P,{className:"mb-4 ".concat(u?"bg-amber-50 dark:bg-amber-950 border-amber-200 dark:border-amber-900":"bg-red-50 dark:bg-red-950 border-red-200 dark:border-red-900"),children:[u?(0,s.jsx)(p.A,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"}):(0,s.jsx)(p.A,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),(0,s.jsxs)(F,{className:"".concat(u?"text-amber-800 dark:text-amber-300":"text-red-800 dark:text-red-300"," ml-2 flex items-center gap-2"),children:[h,o.code&&(0,s.jsxs)("span",{className:"text-xs opacity-75",children:["(",o.code,")"]})]}),(0,s.jsxs)(M,{className:"".concat(u?"text-amber-700 dark:text-amber-400":"text-red-700 dark:text-red-400"," ml-2 flex flex-col gap-2"),children:[(0,s.jsx)("span",{children:o.message}),d&&(0,s.jsx)("span",{className:"text-sm",children:"The backend API service may be offline or starting up. This is normal as the server goes to sleep after periods of inactivity."}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:["rate_limit_with_fallback"===o.type&&o.fallbackModel&&o.onRetryFallback&&(0,s.jsxs)(m.$,{size:"sm",variant:"outline",className:"text-xs h-7 border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900 text-amber-800 dark:text-amber-300",onClick:()=>o.onRetryFallback(o.fallbackModel),children:[(0,s.jsx)(f.A,{className:"h-3 w-3 mr-1"})," Try with a different model"]}),"rate_limit_wait"===o.type&&o.waitTime&&o.onRetry&&(0,s.jsxs)(m.$,{size:"sm",variant:"outline",className:"text-xs h-7 border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900 text-amber-800 dark:text-amber-300",onClick:()=>{ef.oR.info("Retrying in ".concat(o.waitTime," seconds...")),setTimeout(()=>o.onRetry(),1e3*o.waitTime)},children:[(0,s.jsx)(f.A,{className:"h-3 w-3 mr-1"})," Retry in ",o.waitTime,"s"]}),("api_error"===o.type||"network"===o.type||"timeout"===o.type)&&o.onRetry&&(0,s.jsxs)(m.$,{size:"sm",variant:"outline",className:"text-xs h-7 ".concat(u?"border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900 text-amber-800 dark:text-amber-300":"border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900 text-red-800 dark:text-red-300"),onClick:!0===o.onRetry?()=>window.location.reload():o.onRetry,children:[(0,s.jsx)(f.A,{className:"h-3 w-3 mr-1"})," Try with a different model"]}),d&&c&&"function"==typeof c.checkBackendStatus&&(0,s.jsxs)(m.$,{size:"sm",variant:"outline",className:"text-xs h-7 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900 text-blue-800 dark:text-blue-300",onClick:()=>c.checkBackendStatus(),children:[(0,s.jsx)(b.A,{className:"h-3 w-3 mr-1"})," Check Server Status"]})]})]})]})},eD=e=>{let{loading:t,progress:a}=e;return t&&a?(0,s.jsx)("div",{className:"absolute inset-0 bg-black/5 dark:bg-black/20 backdrop-blur-[1px] flex items-center justify-center z-50 rounded-lg",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-900 p-4 rounded-lg shadow-lg flex flex-col items-center gap-2 min-w-[200px]",children:[(0,s.jsx)(j.A,{className:"h-6 w-6 animate-spin text-primary"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:a||"Processing..."})]})}):null},ez=e=>{let{children:t}=e;return(0,s.jsx)(l.oz,{remarkPlugins:[o.A],rehypePlugins:[c.A],components:{h1:e=>{let{node:t,...a}=e;return(0,s.jsx)("h1",{className:"text-xl my-3 font-bold",...a})},h2:e=>{let{node:t,...a}=e;return(0,s.jsx)("h2",{className:"text-lg my-3 font-bold",...a})},h3:e=>{let{node:t,...a}=e;return(0,s.jsx)("h3",{className:"text-base my-2.5 font-semibold",...a})},p:e=>{let{node:t,...a}=e;return(0,s.jsx)("p",{className:"my-2",...a})},ul:e=>{let{node:t,...a}=e;return(0,s.jsx)("ul",{className:"list-disc pl-5 my-2",...a})},ol:e=>{let{node:t,...a}=e;return(0,s.jsx)("ol",{className:"list-decimal pl-5 my-2",...a})},li:e=>{let{node:t,...a}=e;return(0,s.jsx)("li",{className:"ml-2 my-1",...a})},strong:e=>{let{node:t,...a}=e;return(0,s.jsx)("strong",{className:"font-bold",...a})},em:e=>{let{node:t,...a}=e;return(0,s.jsx)("em",{className:"italic",...a})}},children:t})},eW=(e,t,a)=>{let s=e.replace(/\[GRADE:\d\]/g,"");switch(t){case"clipboard":return navigator.clipboard.writeText(s),"Feedback copied to clipboard!";case"email":let r=encodeURIComponent("GCSE Grade ".concat(a," Feedback")),n=encodeURIComponent(s);return window.open("mailto:?subject=".concat(r,"&body=").concat(n)),"Email client opened";case"twitter":let i=encodeURIComponent("I received a Grade ".concat(a," on my GCSE assessment! #GCSE #Education"));return window.open("https://twitter.com/intent/tweet?text=".concat(i)),"Twitter share opened";case"facebook":return window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(window.location.href))),"Facebook share opened";default:return""}},e$=async(e,t)=>{try{let s=await a.e(699).then(a.t.bind(a,52699,23)),r=await a.e(978).then(a.bind(a,40978)),n=s.default,i=r.default,l=e.current;if(!l)return void ef.oR.error("Feedback element not found for PDF export.");let o=await n(l,{scale:2.5,useCORS:!0,logging:!1,scrollY:-window.scrollY,windowWidth:l.scrollWidth,windowHeight:l.scrollHeight,backgroundColor:window.getComputedStyle(document.documentElement).getPropertyValue("--card").trim()||"#ffffff"}),c=o.toDataURL("image/png"),d=new i("p","mm","a4",!0),m=d.internal.pageSize.getWidth(),u=d.internal.pageSize.getHeight(),h=o.width,x=o.height,g=Math.min(m/h,u/x);return d.addImage(c,"PNG",(m-h*g)/2,(u-x*g)/2,h*g,x*g),d.save("GCSE_Grade".concat(t||"N/A","_Feedback.pdf")),ef.oR.success("Feedback saved as PDF"),"Feedback saved as PDF"}catch(e){console.error("Error saving PDF:",e),ef.oR.error("Could not generate PDF. Please try again.")}},eJ=e=>{try{let t=window.open("","_blank"),a=e.current.innerHTML;return t.document.write('\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>GCSE Assessment Feedback</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; }\n            .feedback-container { max-width: 800px; margin: 0 auto; }\n            h1, h2, h3 { color: #333; }\n            ul { padding-left: 20px; }\n            li { margin-bottom: 5px; }\n            .grade { display: inline-block; width: 40px; height: 40px; \n                    background: #f0f0f0; border-radius: 50%; text-align: center; \n                    line-height: 40px; font-weight: bold; font-size: 20px; \n                    margin: 10px 0; }\n          </style>\n        </head>\n        <body>\n          <div class="feedback-container">\n            <h1>GCSE Assessment Feedback</h1>\n            '.concat(a,"\n          </div>\n          <script>\n            window.onload = function() { window.print(); window.close(); }\n          <\/script>\n        </body>\n      </html>\n    ")),t.document.close(),"Print dialog opened"}catch(e){console.error("Error printing feedback:",e),alert("Could not open print dialog. Please try again or use another method to save the feedback.")}},eL=(0,r.forwardRef)((e,t)=>{let{children:a,...r}=e;return(0,s.jsx)(n.P.li,{ref:t,...r,children:a})});eL.displayName="MotionListItem";let eH=e=>{let{feedback:t,grade:a,modelName:i,achievedMarks:l,totalMarks:o,hasMarkScheme:c,onAskFollowUp:d=()=>{},followUpEnabled:u=!0}=e,h=(0,r.useRef)(null),[x,g]=(0,r.useState)(null),p=e=>{g(eW(t,e,a)),setTimeout(()=>g(null),2e3)},b=async()=>{g(await e$(h,a)),setTimeout(()=>g(null),2e3)};return(0,s.jsxs)("div",{className:"relative",children:[x&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute -top-10 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-3 py-1.5 rounded text-sm z-10",children:x}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,s.jsxs)("div",{className:"flex flex-col items-start gap-2 mr-2",children:[(0,s.jsxs)("div",{className:"inline-flex items-center justify-center px-3 py-1.5 bg-gradient-to-br from-indigo-600 to-purple-600 dark:from-indigo-500 dark:to-purple-500 text-white font-bold rounded-md shadow-md",children:["Grade: ",a]}),l&&o&&(0,s.jsxs)("div",{className:"inline-flex items-center justify-center px-3 py-1.5 bg-gradient-to-br from-green-600 to-teal-600 dark:from-green-500 dark:to-teal-500 text-white font-bold rounded-md shadow-md",children:["Mark: ",l,"/",o]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center",children:["Feedback",(0,s.jsxs)("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["by ",i]}),c&&(0,s.jsx)(_.E,{variant:"outline",className:"ml-2 px-1.5 py-0 text-[10px] bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 border-green-200 dark:border-green-900/50",children:"Mark Scheme Analysis"})]})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(q.Bc,{children:(0,s.jsxs)(q.m_,{children:[(0,s.jsx)(q.k$,{asChild:!0,children:(0,s.jsx)(m.$,{variant:"ghost",size:"sm",onClick:()=>window.location.reload(),className:"h-8 w-8 p-0 rounded-full",children:(0,s.jsx)(f.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})})}),(0,s.jsx)(q.ZI,{children:(0,s.jsx)("p",{children:"Try a different model"})})]})}),(0,s.jsxs)(el,{children:[(0,s.jsx)(q.Bc,{children:(0,s.jsxs)(q.m_,{children:[(0,s.jsx)(q.k$,{asChild:!0,children:(0,s.jsx)(eo,{asChild:!0,children:(0,s.jsx)(m.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 rounded-full",children:(0,s.jsx)(w.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})})})}),(0,s.jsx)(q.ZI,{children:(0,s.jsx)("p",{children:"Share feedback"})})]})}),(0,s.jsxs)(ec,{align:"end",className:"w-56",children:[(0,s.jsx)(em,{children:"Share Feedback"}),(0,s.jsx)(eu,{}),(0,s.jsxs)(ed,{onClick:()=>p("clipboard"),children:[(0,s.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Copy to clipboard"})]}),(0,s.jsxs)(ed,{onClick:()=>p("email"),children:[(0,s.jsx)(X.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Share via email"})]}),(0,s.jsxs)(ed,{onClick:()=>p("twitter"),children:[(0,s.jsx)(ee.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Share on Twitter"})]}),(0,s.jsxs)(ed,{onClick:()=>p("facebook"),children:[(0,s.jsx)(et.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Share on Facebook"})]}),(0,s.jsx)(eu,{}),(0,s.jsxs)(ed,{onClick:b,children:[(0,s.jsx)(ea.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Save as PDF"})]}),(0,s.jsxs)(ed,{onClick:()=>{g(eJ(h)),setTimeout(()=>g(null),2e3)},children:[(0,s.jsx)(es.A,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"Print feedback"})]})]})]})]})]}),(0,s.jsx)("div",{ref:h,className:"prose prose-sm dark:prose-invert prose-p:my-2 prose-h1:text-xl prose-h1:my-3 prose-h2:text-lg prose-h2:my-3 prose-h3:text-base prose-h3:font-semibold prose-h3:my-2.5 max-w-none bg-white dark:bg-gray-900 p-4 rounded-lg shadow-sm border border-gray-100 dark:border-gray-800",children:(0,s.jsx)(ez,{children:t})}),u&&(0,s.jsx)("div",{className:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-4",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-base font-semibold mb-1 flex items-center",children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-1.5 text-primary"}),"Need more help understanding this feedback?"]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ask a follow-up question about anything you didn't understand in the feedback."})]}),(0,s.jsx)(m.$,{onClick:d,className:"whitespace-nowrap",children:"Ask Follow-Up Question"})]})})]})},eV=e=>{let{thinking:t,loading:a}=e;return a&&(!t||0===t.length)?(0,s.jsxs)("div",{className:"absolute inset-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm flex flex-col items-center justify-center z-10 rounded-lg p-4",children:[(0,s.jsx)(j.A,{className:"h-8 w-8 animate-spin text-indigo-500 mb-3"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Model is thinking..."}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Please wait while the AI processes your request."})]}):(0,s.jsx)(i.N,{children:t&&t.length>0&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3},className:"absolute inset-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md flex flex-col items-center justify-center z-10 rounded-lg p-6 shadow-xl border border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center mb-3",children:[(0,s.jsx)(b.A,{className:"h-6 w-6 text-yellow-500 mr-2"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Model Thinking Process"})]}),(0,s.jsx)(ej.F,{className:"h-[120px] w-full rounded-md border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 p-3 text-sm",children:(0,s.jsx)("ul",{className:"space-y-1.5 text-gray-700 dark:text-gray-300",children:t.map((e,t)=>(0,s.jsxs)(eL,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"flex items-start",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:e})]},t))})}),a&&(0,s.jsxs)("div",{className:"flex items-center mt-3 text-xs text-gray-500 dark:text-gray-400",children:[(0,s.jsx)(j.A,{className:"h-3 w-3 animate-spin mr-1.5"}),"Still processing..."]})]})})},eK=e=>{var t;let{loading:a,feedback:r,grade:n,selectedModel:i,modelThinking:l,achievedMarks:o,totalMarks:c,processingProgress:d,setActiveTab:u,markScheme:h,onAskFollowUp:x,followUpEnabled:g=!0}=e,p=(null==(t=eP.find(e=>e.value===i))?void 0:t.label)||"AI";return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(eD,{loading:a,progress:d}),(a||l)&&"microsoft/mai-ds-r1:free"===i&&(0,s.jsx)(eV,{thinking:l,loading:a}),r?(0,s.jsx)(eH,{feedback:r,grade:n,modelName:p,achievedMarks:o,totalMarks:c,hasMarkScheme:!!h,onAskFollowUp:x,followUpEnabled:g}):a?(0,s.jsxs)("div",{className:"min-h-[300px] flex flex-col items-center justify-center text-center p-6 border border-dashed border-border rounded-lg bg-muted/20",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Generating Feedback..."}),(0,s.jsx)("p",{className:"text-muted-foreground max-w-md mt-2",children:"Please wait while the AI analyzes your answer. This may take up to 90 seconds depending on the model selected."})]}):(0,s.jsxs)("div",{className:"min-h-[300px] flex flex-col items-center justify-center text-center p-6 border border-dashed border-border rounded-lg bg-muted/20",children:[(0,s.jsx)("div",{className:"mb-4 p-3 rounded-full bg-muted",children:(0,s.jsx)(v.A,{className:"h-6 w-6 text-muted-foreground"})}),(0,s.jsx)("h3",{className:"text-lg font-medium",children:"No Feedback Yet"}),(0,s.jsx)("p",{className:"text-muted-foreground max-w-md mb-6",children:'Enter your question and answer in the Answer tab, then click "Mark Answer" to receive AI feedback and a GCSE grade.'}),(0,s.jsx)(m.$,{variant:"outline",onClick:()=>u("answer"),className:"text-sm",children:"Go to Answer Tab"})]})]})},eQ=e=>{let{onClose:t}=e;return(0,s.jsxs)("div",{className:"mb-6 bg-white dark:bg-gray-900 rounded-lg border shadow-sm overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center bg-blue-50 dark:bg-blue-950 border-b border-blue-100 dark:border-blue-900 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-lg font-semibold text-blue-800 dark:text-blue-300",children:"Quick Guide"}),(0,s.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:"How to use the GCSE AI Marker"})]}),(0,s.jsxs)(m.$,{variant:"ghost",size:"sm",className:"text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900 h-8 w-8 p-0 rounded-full",onClick:t,children:[(0,s.jsx)(k.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("ol",{className:"space-y-2",children:[(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300 font-medium",children:"1"}),(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Enter your question and answer in the text boxes."})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300 font-medium",children:"2"}),(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Select the subject, exam board, and question type."})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300 font-medium",children:"3"}),(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:'Click "Mark Answer" to get AI feedback.'})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300 font-medium",children:"4"}),(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Review the feedback and grade provided."})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300 font-medium",children:"5"}),(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Optionally save, share or print your feedback."})]})]}),(0,s.jsxs)("div",{className:"mt-6 pt-4 border-t border-border",children:[(0,s.jsx)("h3",{className:"font-medium text-base mb-3 text-gray-800 dark:text-gray-200",children:"Quick Tips"}),(0,s.jsxs)("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2",children:[(0,s.jsxs)("li",{className:"flex items-start",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-1.5 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:"Enter both the question and your full answer for accurate marking."})]}),(0,s.jsxs)("li",{className:"flex items-start",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-1.5 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:"Select the correct subject and exam board for tailored feedback."})]}),(0,s.jsxs)("li",{className:"flex items-start",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-1.5 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:"For image uploads, ensure the text is clear and readable."})]}),(0,s.jsxs)("li",{className:"flex items-start",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-1.5 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:"The AI models are good, but always cross-reference with official materials."})]}),(0,s.jsxs)("li",{className:"flex items-start",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-1.5 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:"Wait for the backend to wake up when you first visit the site (may take up to 60 seconds)"})]})]})]})]})]})},eY={QUESTION:"aimarker_question",ANSWER:"aimarker_answer",SUBJECT:"aimarker_subject",EXAM_BOARD:"aimarker_examBoard",MODEL:"aimarker_model",TIER:"aimarker_tier"},eZ=e=>{var t;let{open:a,onOpenChange:r,item:n,onClose:i}=e;return n?(0,s.jsx)(W,{open:a,onOpenChange:r,children:(0,s.jsxs)(L,{className:"sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[(0,s.jsxs)(H,{children:[(0,s.jsxs)(K,{children:["Item ",n.itemIndex+1," Details"]}),(0,s.jsx)(Q,{children:"Full question, answer and feedback details"})]}),(0,s.jsxs)("div",{className:"space-y-4 my-4",children:[(0,s.jsxs)("div",{className:"border-b pb-2",children:[(0,s.jsx)("h3",{className:"font-medium text-lg",children:"Question"}),(0,s.jsx)("p",{className:"mt-1",children:n.question})]}),(0,s.jsxs)("div",{className:"border-b pb-2",children:[(0,s.jsx)("h3",{className:"font-medium text-lg",children:"Answer"}),(0,s.jsx)("p",{className:"mt-1",children:n.answer})]}),(0,s.jsxs)("div",{className:"border-b pb-2",children:[(0,s.jsx)("h3",{className:"font-medium text-lg",children:"Feedback"}),n.error?(0,s.jsxs)(P,{variant:"destructive",className:"mt-2",children:[(0,s.jsx)(p.A,{className:"h-4 w-4"}),(0,s.jsx)(F,{children:"Error"}),(0,s.jsx)(M,{children:n.error})]}):(0,s.jsx)("div",{className:"mt-1 prose prose-sm dark:prose-invert max-w-none",children:(0,s.jsx)(ez,{children:n.feedback})})]}),!n.error&&(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"font-medium mr-2",children:"Grade:"}),(0,s.jsx)("div",{className:"inline-flex items-center justify-center h-8 w-8 bg-gradient-to-br from-indigo-600 to-purple-600 dark:from-indigo-500 dark:to-purple-500 text-white font-bold rounded-full shadow-md",children:n.grade||"N/A"})]}),n.achievedMarks&&n.totalMarks&&(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"font-medium mr-2",children:"Marks:"}),(0,s.jsxs)("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-xs font-medium rounded-full",children:[n.achievedMarks,"/",n.totalMarks]})]}),n.modelName&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,s.jsx)("span",{className:"font-medium",children:"Model:"})," ",(null==(t=eP.find(e=>e.value===n.modelName))?void 0:t.label)||n.modelName]})]})]}),(0,s.jsx)(V,{children:(0,s.jsx)(m.$,{onClick:i,children:"Close"})})]})}):null},eX=e=>{let{isProcessing:t,progress:a,onPause:r,onResume:n,onCancel:i,isPaused:l,parallelism:o,onParallelismChange:c}=e;return(0,s.jsxs)("div",{className:"flex flex-col space-y-3 mt-2 mb-4",children:[(0,s.jsx)("div",{className:"w-full bg-muted rounded-full h-2.5",children:(0,s.jsx)("div",{className:"bg-primary h-2.5 rounded-full transition-all duration-300",style:{width:"".concat(Math.round(a.processed/a.total*100),"%")}})}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[(0,s.jsxs)("span",{children:["Processing ",a.processed," of ",a.total," items"]}),(0,s.jsxs)("span",{children:[Math.round(a.processed/a.total*100),"% complete"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eh.J,{htmlFor:"parallelism",className:"text-xs whitespace-nowrap",children:"Parallel Tasks:"}),(0,s.jsxs)(x.l6,{value:o.toString(),onValueChange:e=>c(parseInt(e)),disabled:t,children:[(0,s.jsx)(x.bq,{className:"h-7 w-16 text-xs",children:(0,s.jsx)(x.yv,{placeholder:o})}),(0,s.jsxs)(x.gC,{children:[(0,s.jsx)(x.eb,{value:"1",children:"1"}),(0,s.jsx)(x.eb,{value:"2",children:"2"}),(0,s.jsx)(x.eb,{value:"3",children:"3"}),(0,s.jsx)(x.eb,{value:"4",children:"4"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[l?(0,s.jsxs)(m.$,{size:"sm",variant:"outline",onClick:n,disabled:!t,children:[(0,s.jsx)(f.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Resume"]}):(0,s.jsxs)(m.$,{size:"sm",variant:"outline",onClick:r,disabled:!t,children:[(0,s.jsx)(N.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Pause"]}),(0,s.jsxs)(m.$,{size:"sm",variant:"outline",onClick:i,disabled:!t,children:[(0,s.jsx)(k.A,{className:"mr-1.5 h-3.5 w-3.5"}),"Cancel"]})]})]})]})},e0=()=>{var e,t,a,l;(0,r.useEffect)(()=>{console.log("Using API URL: ".concat(eC),"GitHub Pages: ".concat(eR)),window.BACKEND_STATUS||(window.BACKEND_STATUS={status:"checking",lastChecked:null})},[]);let[o,c]=(0,r.useState)(""),[w,y]=(0,r.useState)(""),[N,I]=(0,r.useState)("english"),[B,G]=(0,r.useState)("aqa"),[D,z]=(0,r.useState)("general"),[$,J]=(0,r.useState)("student"),[Z,X]=(0,r.useState)(""),[ee,et]=(0,r.useState)(null),[es,er]=(0,r.useState)("answer"),[en,ei]=(0,r.useState)(""),[el,eo]=(0,r.useState)(!1),[ec,ed]=(0,r.useState)([]),[em,eu]=(0,r.useState)(eE),ew=(0,r.useRef)(null),[ek,eN]=(0,r.useState)(""),[eD,eW]=(0,r.useState)(""),[e$,eJ]=(0,r.useState)(""),[eL,eH]=(0,r.useState)(null),[eV,e0]=(0,r.useState)(null),[e1,e2]=(0,r.useState)(!1),[e4,e3]=(0,r.useState)(""),[e5,e6]=(0,r.useState)(!1),[e8,e9]=(0,r.useState)(!1),[e7,te]=(0,r.useState)("higher"),[tt,ta]=(0,r.useState)(null),[ts,tr]=(0,r.useState)(""),[tn,ti]=(0,r.useState)(!1),[tl,to]=(0,r.useState)(!1),[tc,td]=(0,r.useState)(!1),[tm,tu]=(0,r.useState)(""),{checkBackendStatus:th}=(0,eg.Q)(eC),[tx,tg]=(0,r.useState)(null),[tp,tf]=(0,r.useState)([]),[tb,tj]=(0,r.useState)([]),[tw,tv]=(0,r.useState)(!1),[tk,ty]=(0,r.useState)("global"),[tN,tS]=(0,r.useState)({processed:0,total:0,currentItem:null}),tA=(0,r.useRef)(null),[tC,tR]=(0,r.useState)(null),[tE,tT]=(0,r.useState)(!1),[tI,tP]=(0,r.useState)(!1),tF=(0,r.useRef)({cancel:!1,pause:!1}),[tM,tO]=(0,r.useState)(1),[tq,t_]=(0,r.useState)(!1),[tB,tU]=(0,r.useState)(""),[tG,tD]=(0,r.useState)(""),[tz,tW]=(0,r.useState)(!1),t$=async()=>{if(!selectedImage)return void ef.oR.error("Please upload an image first");try{let e;ef.oR.info("Processing image..."),setProcessingStep("reading_image"),setIsProcessing(!0),ae(10);let t=new FormData;t.append("image",selectedImage),"ocr"===B?(e=eO.image_processing.ocr,ef.oR.info("Using OCR-specific model for processing")):e=eO.image_processing.default,t.append("model",e);let a=window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname?"https://beenycool-github-io.onrender.com/api/github/completions":(0,eA.xT)("github/completions");setProcessingStep("analyzing_content"),ae(30);let s=await fetch(a,{method:"POST",body:t,cache:"no-store"});if(!s.ok){let e=await s.text();throw Error("OCR failed: ".concat(s.status," ").concat(e))}let r=await s.json();console.log("API Response received:",r),r.choices&&r.choices[0]&&(console.log("First choice:",r.choices[0]),r.choices[0].message&&console.log("Message content:",r.choices[0].message.content)),r.text&&""!==r.text.trim()?(tr(r.text),ti(!0),ef.oR.success("Image processed. Review extracted text.")):(ef.oR.warning("No text detected in image, or extracted text is empty."),tr(""))}catch(e){console.error("Error processing image:",e),t2({type:"api",message:"Failed to process image: ".concat(e.message)}),ef.oR.error("Failed to process image: "+e.message)}finally{ax(!1)}},[tJ,tL]=(0,r.useState)(!1),[tH,tV]=(0,r.useState)(!1),[tK,tQ]=(0,r.useState)(!1),[tY,tZ]=(0,r.useState)(""),[tX,t0]=(0,r.useState)(""),[t1,t2]=(0,r.useState)(null),[t4,t3]=(0,r.useState)(null),[t5,t6]=(0,r.useState)(null),[t8,t9]=(0,r.useState)(null),[t7,ae]=(0,r.useState)(""),[at,aa]=(0,r.useState)([]),[as,ar]=(0,r.useState)(0),[an,ai]=(0,r.useState)(0),[al,ao]=(0,r.useState)(new Date().toDateString()),[ac,ad]=(0,r.useState)("deepseek/deepseek-chat-v3-0324:free"),[am,au]=(0,r.useState)({}),[ah,ax]=(0,r.useState)(!1),[ag,ap]=(0,r.useState)(!1);(0,r.useRef)(null);let af=(0,r.useRef)(null),ab=(0,r.useRef)(null),aj=(0,r.useRef)(null),aw=(0,r.useRef)(null),av=(0,r.useRef)(null),ak=(0,r.useRef)(!1),ay=(0,r.useRef)("checking"),aN=(0,r.useRef)(null),[aS,aA]=(0,r.useState)(!1),[aC,aR]=(0,r.useState)(!0),[aE,aT]=(0,r.useState)(2048),[aI,aP]=(0,r.useState)(0),[aF,aM]=(0,r.useState)(eq["deepseek/deepseek-chat-v3-0324:free"]||1024),[aO,aq]=(0,r.useState)(!0),a_=e=>{aN.current=e,aO&&eq[e]&&aM(eq[e]),au(t=>({...t,[e]:Date.now()}))},aB=(0,r.useCallback)((e,t)=>{U()((e,t)=>{localStorage.setItem(eY.QUESTION,e),localStorage.setItem(eY.ANSWER,t)},1500)(e,t)},[]);(0,r.useEffect)(()=>{(o||w)&&aB(o,w)},[o,w,aB]);let aU=(0,r.useCallback)(()=>{let e=localStorage.getItem("requestTokens"),t=new Date().toDateString(),a=e?JSON.parse(e):{count:500,lastReset:t};return a.lastReset!==t&&(a={count:500,lastReset:t}),a},[]);(0,r.useEffect)(()=>{let e=localStorage.getItem(eY.QUESTION),t=localStorage.getItem(eY.ANSWER);e&&c(e),t&&y(t);let a=localStorage.getItem(eY.SUBJECT);a&&eE.find(e=>e.value===a)&&I(a);let s=localStorage.getItem(eY.EXAM_BOARD);s&&eT.find(e=>e.value===s)&&G(s);let r="gemini-2.5-flash-preview-05-20",n=localStorage.getItem(eY.MODEL);n&&eP.find(e=>e.value===n)&&(r=n),ad(r),aN.current=r,aM(eq[r]||1024);let i=localStorage.getItem(eY.TIER);("higher"===i||"foundation"===i)&&te(i),aP(aU().count)},[aU]),(0,r.useEffect)(()=>{localStorage.setItem(eY.SUBJECT,N)},[N]),(0,r.useEffect)(()=>{localStorage.setItem(eY.EXAM_BOARD,B)},[B]),(0,r.useEffect)(()=>{localStorage.setItem(eY.MODEL,ac);let e=eq[ac]||1024;aF!==e&&aM(e),aN.current=ac},[ac]),(0,r.useEffect)(()=>{localStorage.setItem(eY.TIER,e7)},[e7]),(0,r.useEffect)(()=>{aP(aU().count)},[aU]);let aG=(0,r.useCallback)(()=>{let e=aU();return!(e.count<=0)&&(e.count-=1,localStorage.setItem("requestTokens",JSON.stringify(e)),aP(e.count),!0)},[aU]);(0,r.useCallback)((e,t)=>{console.log("Backend status changed:",e,t),ay.current=e,"offline"===e||"error"===e?ap(!0):ap(!1)},[]);let{classifySubjectAI:aD,debouncedClassifySubject:az}=(0,eg.h)(e_,tK),{checkBackendStatus:aW}=(0,eg.Q)(eC);(0,r.useEffect)(()=>{{let e=window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname;e9(e),e&&(console.log("Running on GitHub Pages - simulating online status for UI rendering (mount effect)"),ay.current="online")}},[]),(0,r.useEffect)(()=>{!(o.length>20)||ak.current||tK||az(o+" "+w,N,ak,em,I,t6,t3)},[o,w,az,N,tK,em,t6,t3,ak]);let a$=()=>{var e,t,a;console.log("AIMarker state for system prompt:",{subject:N,examBoard:B,questionType:D,userType:$,markScheme:Z,totalMarks:ek,textExtract:eD,relevantMaterial:e$,tier:e7,allSubjects:em});let s="You are an AI assistant specialized in educational assessment.";if($&&(s+=" You are acting as a ".concat($,".")),N&&(s+=" Your current task is to assess a piece of work for the subject: ".concat(N,".")),em&&(null==(e=em.find(e=>e.value===N))?void 0:e.hasTiers)&&e7&&(s+=" The work is for the ".concat(e7," tier.")),B&&(s+=" The examination board is ".concat(B,".")),D&&"general"!==D){let e=null==(a=eB[N])||null==(t=a[B])?void 0:t.find(e=>e.value===D);e&&(s+=" Specifically, this is for ".concat(e.label,"."))}return ek&&(s+=" The question is out of ".concat(ek," marks.")),Z&&(s+="\n\nThe following mark scheme should be used as a guide if available:\n```\n".concat(Z,"\n```\n")),eD&&(s+="\n\nA text extract has been provided and may be relevant:\n```\n".concat(eD,"\n```\n")),e$&&(s+="\n\nOther relevant material to consider:\n```\n".concat(e$,"\n```\n")),s+="\nYour primary goal is to provide constructive feedback and a grade based on the user's answer to the question. Adhere to the provided mark scheme if available."},aJ=()=>{console.log("AIMarker state for user prompt:",{question:o,answer:w,totalMarks:ek,subject:N,examBoard:B,questionType:D,textExtract:eD,relevantMaterial:e$,relevantMaterialImageBase64:eV});let e="Please assess the following student's answer.\n\n";return(o?e+="**Question:**\n".concat(o,"\n\n"):e+="**Question:** [Not explicitly provided, infer from context if possible or provide general feedback on the answer below.]\n\n",w)?(e+="**Student's Answer:**\n".concat(w,"\n\n"),ek&&(e+="The question is out of **".concat(ek," marks**.\n\n")),eD&&(e+="**Provided Text Extract (for context):**\n```\n".concat(eD,"\n```\n\n")),e$&&(e+="**Other Provided Relevant Material (for context):**\n```\n".concat(e$,"\n```\n\n")),eV&&(e+="**An image has also been provided with relevant material.** Please consider this in your assessment.\n\n"),e+="Based on all the information provided (including the system prompt context like subject, exam board, and mark scheme if available), please provide:\n",e+="1.  **Overall Feedback:** Constructive comments on the student's performance, highlighting strengths and areas for improvement.\n",e+="2.  **Mark Allocation (if applicable):** If a total mark is specified, suggest a mark out of the total. Briefly justify your mark allocation against the mark scheme or assessment criteria.\n",e+="3.  **Specific Pointers:** Bullet points on specific aspects of the answer, referencing parts of the mark scheme or good practice where appropriate.\n",e+="4.  **Actionable Advice:** Suggestions for how the student can improve in the future.\n\n",e+="Present the feedback clearly and concisely. If a mark scheme was provided in the system prompt, ensure your feedback aligns with it."):e+="**Student's Answer:** [No answer provided. Please indicate that an answer is needed for assessment.]\n\n"},aL=(0,r.useCallback)(async()=>{var e,t,a,s,r;tZ(""),t0(""),t2(null),t3(null),e3(""),ta(null);let n=eO.subject_assessment;if(a_(N&&n?n:ac),!w)return void t2({type:"validation",message:"Please enter an answer to be marked"});tQ(!0),er("feedback"),t3({message:"Initiating request..."});let i=await aW(ac);if(!i.ok){tQ(!1),t2({type:"network",message:"Backend connection error: ".concat(i.error,". Please try again."),retry:!0});return}let l=Date.now(),o=eM[aN.current]||1e4,c=am[aN.current]||0;if(l-c<o){tQ(!1);let e=Math.ceil((o-(l-c))/1e3),s=eF[aN.current];s?t2({type:"rate_limit_with_fallback",message:"".concat(null==(t=eP.find(e=>e.value===aN.current))?void 0:t.label," is rate limited. Try fallback or wait ").concat(e,"s."),fallbackModel:s,onRetryFallback:e=>{var t;ad(e),ef.oR.info("Switched to ".concat(null==(t=eP.find(t=>t.value===e))?void 0:t.label,'. Click "Get Feedback" again.'))},onRetry:()=>aL(),waitTime:e}):t2({type:"rate_limit_wait",message:"".concat(null==(a=eP.find(e=>e.value===aN.current))?void 0:a.label," is limited. Wait ").concat(e,"s."),waitTime:e,onRetry:()=>aL()});return}if(!aG()){tQ(!1),t2({type:"rate_limit",message:"Daily request limit reached (500/day)"});return}au(e=>({...e,[aN.current]:l})),ar(l);let d=a$(),m=aJ();ae("Sending request to AI model..."),t3({message:"Processing with ".concat((null==(e=eP.find(e=>e.value===aN.current))?void 0:e.label)||aN.current,"...")});try{let e={model:aN.current.startsWith("openai/")||aN.current.startsWith("xai/")?aN.current:"xai/grok-3",messages:[{role:"system",content:d},{role:"user",content:m}],temperature:.7,top_p:1,stream:!0};aN.current.startsWith("gemini")&&eL&&eV&&(e.messages[1].content+="\n\nIMAGE PROVIDED: An image has been attached. Please analyze this image.");let t=window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname?"https://beenycool-github-io.onrender.com/api/github/completions":(0,eA.xT)("github/completions");console.log("Sending completions request to:",t);let a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(e),cache:"no-store"});if(!a.ok){let e=a.status,t=await a.text();console.error("GitHub API error: ".concat(e),t);let s=null;try{s=JSON.parse(t)}catch(e){}if(401===e)t2({type:"api_error",message:"Authentication error with GitHub API. Please try a different model.",onRetry:()=>{ad("deepseek/deepseek-chat-v3-0324:free"),a_("deepseek/deepseek-chat-v3-0324:free"),t$()}});else if(404===e)t2({type:"api_error",message:"GitHub API is not available. Please try a different model.",onRetry:()=>{ad("deepseek/deepseek-chat-v3-0324:free"),a_("deepseek/deepseek-chat-v3-0324:free"),t$()}});else{let a=(null==s?void 0:s.error)||(null==s?void 0:s.message)||t||"Unknown error";t2({type:"api_error",message:"API error (".concat(e,"): ").concat(a),onRetry:e>=500?()=>t$():void 0})}tQ(!1);return}if(!a.ok){let e=await a.text(),t={message:"API request failed: ".concat(a.status)};try{t=JSON.parse(e)}catch(e){}let r=eF[aN.current];429===a.status&&r?t2({type:"rate_limit_with_fallback",message:"Model ".concat(null==(s=eP.find(e=>e.value===aN.current))?void 0:s.label," API rate limited. Error: ").concat(t.error||e),fallbackModel:r,onRetryFallback:e=>{var t;ad(e),ef.oR.info("Switched to ".concat(null==(t=eP.find(t=>t.value===e))?void 0:t.label,'. Click "Get Feedback" again.'))},onRetry:()=>aL()}):t2({type:"api_error",message:"API Error: ".concat(t.error||e),onRetry:aL}),tQ(!1),ae("");return}ae("Receiving feedback stream..."),e3("Receiving stream...");let n=a.body.getReader(),i=new TextDecoder,l="";for(;;){let e,{value:t,done:a}=await n.read();if(a){ae(""),e3("Stream complete.");break}l+=i.decode(t,{stream:!0});let s=!1;for(;(e=l.indexOf("\n\n"))>=0;){let t=l.substring(0,e);l=l.substring(e+2);let a=t.split("\n");for(let e of a)if(e.startsWith("event: error")){console.error("SSE stream error event received:",t);let e=null==(r=a.find(e=>e.startsWith("data: ")))?void 0:r.substring(6),n="Error in stream";if(e)try{let t=JSON.parse(e);n=t.error||t.message||"Unknown error from stream"}catch(e){n="Malformed error data in stream"}t2({type:"api_stream_error",message:n,onRetry:aL}),s=!0;break}else if(e.startsWith("data: ")){let t=e.substring(6);if("[DONE]"===t.trim()){console.log("Stream signaled DONE.");continue}try{let e=JSON.parse(t);e.choices&&e.choices[0]&&e.choices[0].delta&&e.choices[0].delta.content?tZ(t=>t+e.choices[0].delta.content):e.text&&tZ(t=>t+e.text)}catch(e){console.warn("Failed to parse streamed JSON data:",t,e)}}if(s)break}if(s){tQ(!1),ae("Error occurred during stream."),e3("Error processing stream."),n&&"function"==typeof n.cancel&&n.cancel().catch(e=>console.warn("Error cancelling reader:",e));break}}}catch(e){console.error("Error during streaming submission:",e),t2({type:"api_error",message:"Streaming Error: ".concat(e.message),onRetry:aL}),ae("Error occurred."),e3("Error during stream.")}finally{}},[w,o,N,B,D,$,Z,ek,eD,e$,ac,e7,am,aG,a$,aJ,eL,eV,aO,aF,aC,aE,aW,t$,a_]);(0,r.useEffect)(()=>{if(tK||""===tY.trim()||t1)tK&&t1&&(tQ(!1),ae("Error occurred."));else{let e=tY,t="",a="",s=null,r=e.match(/\[GRADE:(\d+)\]/i);r&&r[1]&&(t=r[1],e=e.replace(r[0],"").trim());let n=e.match(/\[MARKS:(\d+)\/(\d+)\]/i);n&&n[1]&&(s=n[1],!ek&&n[2]&&eN(n[2]),e=e.replace(n[0],"").trim());let i=e.match(/Mark Scheme:([\s\S]+?)(?=\n\n[A-Z]|Grade:|Marks:|$)/i);i&&i[1]&&(a=i[1].trim()),t0(t),ta(s),t3({message:"Feedback processed and displayed!"}),ae(""),tQ(!1);let l={id:Date.now(),question:o,answer:w,feedback:tY,grade:t,achievedMarks:s,totalMarks:ek||(n&&n[2]?n[2]:null),markSchemeOutput:a,subject:N,examBoard:B,questionType:D,userType:$,model:aN.current,tier:e7,timestamp:new Date().toISOString(),relevantMaterial:e$||"",markSchemeInput:Z||"",relevantMaterialImagePreview:eL||null,settings:{autoMaxTokens:aC,maxTokens:aE,enableThinkingBudget:aO,thinkingBudget:aF}};aa(e=>[l,...e.slice(0,9)])}},[tK,tY,t1,o,w,N,B,D,$,Z,ek,e$,ac,e7,aC,aE,aO,aF,eL,aa,t0,ta,eN,t3,tQ,ae]);let aH=async()=>{if(!o)return void t2({type:"validation",message:"Please enter a question to generate a mark scheme"});tQ(!0),t2(null),t3({message:"Generating mark scheme..."});[...Object.values(eF)];try{var e,t;let a,s;null==(e=eP.find(e=>e.value===ac))||e.label;let r=ek?null:eU(o),n=ek||r,i="You are an experienced GCSE examiner for ".concat(N,". Create a detailed mark scheme for the provided question based on ").concat(B," examination standards. \n      Include clear assessment objectives, point-by-point criteria, level descriptors if applicable, and a total mark allocation. ").concat(n?"The question is out of ".concat(n," marks."):"","\n      IMPORTANT: Please provide the mark scheme in plain text format only. Do NOT use any Markdown formatting (e.g., no headings, bold text, lists, etc.)."),l="Please create a detailed mark scheme for this GCSE ".concat(N," question for the ").concat(B," exam board:\n      \n      QUESTION: ").concat(o,"\n      ").concat(n?"\nTOTAL MARKS: ".concat(n):"","\n      \n      FORMAT YOUR RESPONSE AS A PROFESSIONAL MARK SCHEME WITH:\n      1. Clear assessment criteria\n      2. Point-by-point allocation of marks\n      3. Examples of acceptable answers where appropriate\n      4. Level descriptors for extended responses\n      5. Total mark allocation");if("gemini-2.5-flash-preview-05-20"===ac){let e={contents:[{parts:[{text:"System: ".concat(i,"\n\nUser: ").concat(l)}]}],generationConfig:{temperature:.3}};aO&&aF>0&&eq[ac]&&(e.config={thinkingConfig:{thinkingBudget:aF}});try{let t=window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname?"https://beenycool-github-io.onrender.com/api/gemini/generate":(0,eA.xT)("gemini/generate");if(console.log("Sending Gemini generate request to:",t),!(a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(6e4),cache:"no-store"})).ok&&400===a.status){let e=await a.text();if(e.includes("not a valid model ID")){console.warn("Model ".concat(ac," not supported by direct Gemini API, falling back to standard chat API"));let e=window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname?"https://beenycool-github-io.onrender.com/api/chat/completions":(0,eA.xT)("chat/completions");console.log("Falling back to chat completions API:",e),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:eF[ac],messages:[{role:"system",content:i},{role:"user",content:l}],temperature:.3}),signal:AbortSignal.timeout(6e4),cache:"no-store"})}else throw Error("Mark scheme generation failed with Gemini API: ".concat(e))}}catch(e){throw e}}else if(ac.startsWith("openai/")||ac.startsWith("xai/")){let e=window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname?"https://beenycool-github-io.onrender.com/api/github/completions":(0,eA.xT)("github/completions");console.log("Sending GitHub completions request to:",e),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:ac.startsWith("openai/")||ac.startsWith("xai/")?ac:"xai/grok-3",messages:[{role:"system",content:i},{role:"user",content:l}],temperature:.7,top_p:1}),signal:AbortSignal.timeout(6e4),cache:"no-store"})}else{let e=(0,eA.xT)("chat/completions");console.log("Sending chat completions request to:",e),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:ac,messages:[{role:"system",content:i},{role:"user",content:l}],temperature:.3}),signal:AbortSignal.timeout(6e4),cache:"no-store"})}if(!a.ok){let e=await a.text(),s="Unknown error occurred";try{let a=JSON.parse(e);s=(null==(t=a.error)?void 0:t.message)||a.message||JSON.stringify(a)}catch(t){s=e||a.statusText}throw Error("Mark scheme generation failed: ".concat(s))}s=await a.json();let c="";console.log("API response format:",Object.keys(s).join(", "));try{if(s.candidates&&s.candidates.length>0&&s.candidates[0].content)s.candidates[0].content.parts&&s.candidates[0].content.parts.length>0?(c=s.candidates[0].content.parts[0].text,console.log("Using data.candidates[0].content.parts[0].text format")):"string"==typeof s.candidates[0].content.text&&(c=s.candidates[0].content.text,console.log("Using data.candidates[0].content.text format"));else if(s.choices&&s.choices[0]&&s.choices[0].message)c=s.choices[0].message.content,console.log("Using data.choices[0].message.content format");else if(s.content)c=s.content,console.log("Using data.content format");else if("object"==typeof s&&Object.keys(s).length>0){let e=t=>{if("string"==typeof t)return t;if(!t||"object"!=typeof t)return"";if(t.content&&"string"==typeof t.content)return t.content;if(t.text&&"string"==typeof t.text)return t.text;if(t.message&&t.message.content&&"string"==typeof t.message.content)return t.message.content;for(let a in t){if("string"==typeof t[a]&&t[a].length>100)return t[a];if("object"==typeof t[a]){let s=e(t[a]);if(s)return s}}return""};(c=e(s))&&console.log("Extracted content from unknown format")}}catch(e){console.error("Error parsing API response:",e)}if(!c)throw console.warn("Unexpected API response format for mark scheme:",s),Error("Unable to extract mark scheme text from API response");X(c),t3({message:"Mark scheme generated successfully!"})}catch(e){console.error("Error generating mark scheme:",e),"AbortError"===e.name?t2({type:"timeout",message:"Mark scheme generation timed out.",onRetry:aH}):t2({type:"api_error",message:"Failed to generate mark scheme: ".concat(e.message),onRetry:aH})}finally{tQ(!1)}},aV=async(e,t,a)=>{var s,r,n,i,l,o,c;ef.oR.info("Processing item ".concat(t+1,"/").concat(a,": ").concat(null==(s=e.question)?void 0:s.substring(0,30),"..."));let m=e.model,u=eM[m]||1e4,h=Date.now(),x=am.global_request_time||0;if(h-x<5e3){let e=Math.ceil((5e3-(h-x))/1e3);ef.oR.warning("Global rate limit: Waiting ".concat(e,"s.")),await new Promise(t=>setTimeout(t,1e3*e))}let g=am[m]||0;if(h-g<u){let e=Math.ceil((u-(h-g))/1e3);ef.oR.warning("Rate limit for ".concat((null==(r=eP.find(e=>e.value===m))?void 0:r.label)||m,": Waiting ").concat(e,"s.")),await new Promise(t=>setTimeout(t,1e3*e))}au(e=>({...e,[m]:Date.now(),global_request_time:Date.now()}));try{let a,s=(()=>{let t="You are an experienced GCSE ".concat(e.subject," examiner. Your task is to provide detailed, constructive feedback for ").concat("teacher"===e.userType?"assessment purposes":"student learning"," following these guidelines:\n\n1. ASSESSMENT CRITERIA:\n- Accuracy of content (subject knowledge)\n- Clarity and structure of response\n- Use of evidence/examples\n- Depth of analysis (where applicable)\n- Technical accuracy (spelling, grammar, terminology)"),a=em.find(t=>t.value===e.subject);if(null==a?void 0:a.hasTiers){var s;t+="\n- This is a ".concat(null==(s=e.tier)?void 0:s.toUpperCase()," tier question")}t+='\n\n2. FEEDBACK STRUCTURE:\na) Performance overview that addresses the overall quality of the answer (2-3 sentences)\nb) 3-4 specific strengths with concrete examples from the student\'s work, using phrases like "You demonstrated...", "Your analysis of...", or "I was particularly impressed by..."\nc) 3-4 specific areas for improvement using the "WWW/EBI" format (What Went Well/Even Better If), with each point structured as:\n   * Clear identification of the issue\n   * Evidence from the student\'s work\n   * Specific, achievable action to improve\n   * Link to how this would affect their grade\nd) Clear progression pathway that explains exactly what would be needed to achieve the next grade level\ne) GCSE grade (9-1) in the format: [GRADE:X] where X is the grade number, with a brief justification of the grade awarded';let r=e.totalMarks?null:eU(e.question),n=e.totalMarks||r;return n&&(t+="\nf) Marks achieved in the format: [MARKS:Y/".concat(n,"] where Y is the number of marks achieved")),e.markScheme&&(t+='\n\n3. MARK SCHEME ANALYSIS:\n- Approach the mark scheme like an examiner, using precise analytical language\n- Assess each assessment objective (AO) point-by-point with specific examples:\n  * For each point awarded: "Credit given for [specific criteria] as evidenced by [exact quote/reference from answer]"\n  * For each point missed: "No credit for [specific criteria] because [specific explanation]"\n- Follow a structured marking pattern using annotations: \n  *  = criterion fully met with specific highlighted evidence\n  * ~ = criterion partially met with explanation of what\'s missing\n  *  = criterion not met with specific guidance for improvement\n- Use precise examiner language (e.g., "demonstrates comprehensive understanding," "shows limited analysis," "lacks sufficient development")\n- Award marks according to level descriptors, explaining why the answer falls into a particular band\n- Clearly justify the final mark total with reference to the mark scheme bands'),"maths"===e.subject?t+="\n\n4. MATHEMATICAL NOTATION:\n- Use LaTeX notation for mathematical expressions enclosed in $ $ for inline formulas and as separate blocks for complex formulas\n- Example inline: $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$\n- Example block:\n$$\nx = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}\n$$\n- Format solutions step-by-step with clear explanations\n- Number equations and reference them in your feedback":t+="\n\n4. SUBJECT-SPECIFIC GUIDANCE:\n".concat((0,d.$G)(e.subject,e.examBoard),"\n\n5. PROFESSIONAL MARKING APPROACH:\n- Use exam board-specific terminology and assessment language\n- Focus on assessment objectives (AOs) relevant to ").concat(e.subject,'\n- Implement a tiered marking approach - first identify the band/level, then refine the exact mark within that band\n- Use marginal annotations to highlight specific points (e.g., "AO2 - Strong analysis here", "Limited evidence", "Good application of knowledge")\n- Balance critical assessment with encouraging language that motivates improvement\n- Ensure developmental feedback is specific and actionable\n- Apply a consistent marking standard throughout the assessment\n- Acknowledge partial understanding where appropriate'),"microsoft/mai-ds-r1:free"===m&&(t+="\n\n5. THINKING PROCESS:\n- First, analyze the student's answer carefully...\n- Mark your thinking process with [THINKING] and your final feedback with [FEEDBACK]"),t})(),r=(()=>{let t="Please mark this GCSE ".concat(e.subject," answer.\n\nQUESTION:\n").concat(e.question,"\n\nSTUDENT ANSWER:\n").concat(e.answer,"\n\n"),a=e.totalMarks?null:eU(e.question),s=e.totalMarks||a;return s&&(t+="TOTAL MARKS: ".concat(s,"\n\n")),t+="INSTRUCTIONS:\n1. Mark this answer as an experienced GCSE ".concat(e.subject," examiner would for the ").concat(e.examBoard," exam board\n2. Follow a methodical assessment process aligned with official marking standards\n3. Use professional examiner language and annotation techniques throughout\n4. Provide detailed, constructive feedback with specific evidence from the student's work\n5. Structure feedback using the WWW/EBI format (What Went Well/Even Better If)\n6. Assign a GCSE grade (9-1) in the format [GRADE:X] with clear justification\n7. Include specific guidance for improving to the next grade level").concat(e.markScheme?"\n8. Apply a rigorous mark-by-mark assessment using the provided mark scheme\n9. Annotate each assessment point with appropriate symbols (, ~, )\n10. Reference specific mark scheme criteria and bands in your assessment\n11. Demonstrate clear reasoning for each mark awarded or withheld":""),s&&(t+="\n4. Assign marks in the format [MARKS:Y/".concat(s,"]")),t})();if(!(a=m.startsWith("openai/")||m.startsWith("xai/")?await fetch("".concat(eC,"/api/github/completions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:m.startsWith("openai/")||m.startsWith("xai/")?m:"xai/grok-3",messages:[{role:"system",content:s},{role:"user",content:r}],max_tokens:aC?void 0:aE,temperature:.7,top_p:1}),cache:"no-store"}):await fetch("".concat(eC,"/api/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:m,messages:[{role:"system",content:s},{role:"user",content:r}],max_tokens:aC?void 0:aE,temperature:.7}),cache:"no-store"})).ok){let e=await a.text(),s=e;try{s=(null==(o=JSON.parse(e).error)?void 0:o.message)||JSON.parse(e).message||e}catch(e){}return{error:"API Error (Item ".concat(t+1,"): ").concat(s," (Model: ").concat(m,")"),feedback:null,grade:null,modelName:m}}let u=await a.json(),h=(null==(l=u.choices)||null==(i=l[0])||null==(n=i.message)?void 0:n.content)||u.content||u.text||u.answer||u.response||"",x=[];if("microsoft/mai-ds-r1:free"===m){let e=h.match(/\[THINKING\]([\s\S]*?)(?:\[FEEDBACK\]|$)/i);if(null==e?void 0:e[1]){x=e[1].trim().split(/\n\s*\n/).map(e=>e.trim());let t=h.match(/\[FEEDBACK\]([\s\S]*?)$/i);h=(null==t||null==(c=t[1])?void 0:c.trim())||h}}let g=h.match(/\[GRADE:(\d+)\]/i),p=(null==g?void 0:g[1])||null,f=h.match(/\[MARKS:(\d+)\/(\d+)\]/i),b=(null==f?void 0:f[1])||null,j=(null==f?void 0:f[2])||e.totalMarks;return{feedback:h.replace(/\[GRADE:\d+\]/gi,"").replace(/\[MARKS:\d+\/\d+\]/gi,"").trim(),grade:p,achievedMarks:b,totalMarks:j,modelThinking:x,modelName:m,error:null}}catch(e){return console.error("Error in processSingleBulkItem (Item ".concat(t+1,"):"),e),{error:"Processing failed (Item ".concat(t+1,"): ").concat(e.message),feedback:null,grade:null,modelName:m}}},aK=async()=>{if(!tx)return void ef.oR.error("Please select a file for bulk processing.");if(tw)return void ef.oR.warning("Bulk processing is already active.");tF.current={cancel:!1,pause:!1},tP(!1),tv(!0),tj([]),tS({processed:0,total:0,currentItem:null}),er("bulk");try{ef.oR.info('Initiating bulk processing for: "'.concat(tx.name,'"...'));let t=tx.name.split(".").pop().toLowerCase();if("csv"===t){if(void 0===eS()){ef.oR.error("CSV Parsing library (PapaParse) is not available. Please ensure it's installed."),tv(!1);return}eS().parse(tx,{header:!0,skipEmptyLines:!0,complete:async t=>{await e(t.data)},error:e=>{console.error("CSV parsing error:",e),ef.oR.error("CSV parsing failed: ".concat(e.message)),tj([{itemIndex:-1,error:"CSV parsing error: ".concat(e.message)}]),tv(!1)}})}else if("json"===t){let t=new FileReader;t.onload=async t=>{try{let a=JSON.parse(t.target.result),s=Array.isArray(a)?a:[a];await e(s)}catch(e){console.error("JSON parsing error:",e),ef.oR.error("JSON parsing failed: ".concat(e.message)),tj([{itemIndex:-1,error:"JSON parsing error: ".concat(e.message)}]),tv(!1)}},t.onerror=e=>{console.error("File reading error:",e),ef.oR.error("File reading failed: ".concat(e.message)),tv(!1)},t.readAsText(tx)}else if("txt"===t){let t=new FileReader;t.onload=async t=>{try{let a=t.target.result.split(/\r?\n/).filter(e=>""!==e.trim()).map((e,t)=>{var a,s,r,n,i;let l=e.includes("	")?e.split("	"):e.split(",");return l.length<2?{error:"Line ".concat(t+1,": Could not parse question and answer")}:{question:l[0].trim(),answer:l[1].trim(),subjectFromFile:null==(a=l[2])?void 0:a.trim(),examBoardFromFile:null==(s=l[3])?void 0:s.trim(),modelFromFile:null==(r=l[4])?void 0:r.trim(),tierFromFile:null==(n=l[5])?void 0:n.trim(),totalMarksFromFile:null==(i=l[6])?void 0:i.trim()}}).filter(e=>!e.error&&e.question&&e.answer);if(0===a.length){ef.oR.error("No valid items found in the text file. Format should be: Question[tab]Answer"),tv(!1);return}await e(a)}catch(e){console.error("Text parsing error:",e),ef.oR.error("Text parsing failed: ".concat(e.message)),tj([{itemIndex:-1,error:"Text parsing error: ".concat(e.message)}]),tv(!1)}},t.onerror=e=>{console.error("File reading error:",e),ef.oR.error("File reading failed: ".concat(e.message)),tv(!1)},t.readAsText(tx)}else ef.oR.error("Unsupported file format: .".concat(t,". Please use CSV, JSON, or TXT files.")),tv(!1)}catch(e){console.error("Bulk processing setup error:",e),ef.oR.error("Bulk processing setup failed: ".concat(e.message)),tj(t=>[...t,{itemIndex:-1,error:e.message}]),tv(!1),tS(e=>({...e,currentItem:null}))}async function e(e){let t=e.map((e,t)=>({id:"item-".concat(t),question:e.Question||e.question,answer:e.Answer||e.answer,subjectFromFile:e.Subject||e.subject||e.subjectFromFile,examBoardFromFile:e.ExamBoard||e.examBoard||e.examBoardFromFile,modelFromFile:e.Model||e.model||e.modelFromFile,tierFromFile:e.Tier||e.tier||e.tierFromFile,totalMarksFromFile:e.TotalMarks||e.totalMarks||e.totalMarksFromFile})).filter(e=>e.question&&""!==e.question.trim()&&e.answer&&""!==e.answer.trim());if(0===t.length){ef.oR.error("No valid items found in the file. Each item must have Question and Answer fields."),tv(!1);return}tf(t),tS(e=>({...e,total:t.length,processed:0,currentItem:null}));let a=[],s=0,r=0,n=0,i=async e=>{let s=t[e];if(tF.current.cancel)return;let r={question:s.question,answer:s.answer,subject:"file"===tk&&s.subjectFromFile?s.subjectFromFile:N,examBoard:"file"===tk&&s.examBoardFromFile?s.examBoardFromFile:B,model:"file"===tk&&s.modelFromFile&&eP.find(e=>e.value===s.modelFromFile)?s.modelFromFile:ac,tier:"file"===tk&&s.tierFromFile?s.tierFromFile:e7,totalMarks:"file"===tk&&s.totalMarksFromFile?s.totalMarksFromFile:ek,userType:$},n=await aV(r,e,t.length);a.push({itemIndex:e,question:s.question,answer:s.answer,feedback:n.feedback,grade:n.grade,achievedMarks:n.achievedMarks,totalMarks:n.totalMarks,modelName:n.modelName,error:n.error}),tj([...a])};(async()=>{for(;r<t.length&&!tF.current.cancel;){if(tF.current.pause){await new Promise(e=>setTimeout(e,500));continue}if(s>=tM){await new Promise(e=>setTimeout(e,100));continue}let e=r++;s++,i(e).then(()=>{s--,n++,tS(e=>({...e,processed:n,currentItem:r<t.length?r:null})),(n>=t.length||r>=t.length)&&(tF.current.cancel||ef.oR.success("Bulk processing complete!"),tv(!1),tP(!1))})}})()}},aQ=e=>{tR(e),tT(!0)},aY=async()=>{if(!tB.trim())return void ef.oR.error("Please enter a question");tW(!0);try{var e,t,a,s;let r;if(!aG()){tW(!1),ef.oR.error("Daily request limit reached");return}if("online"!==ay.current){tW(!1),ef.oR.error("Backend API is not available. Please check connection status.");return}console.log("Submitting follow-up question:",tB);let n="You previously provided feedback on a student's GCSE ".concat(N," answer, giving them a grade ").concat(tX||"N/A",'. \nThe student has a follow-up question about your feedback: "').concat(tB,'"\n\nYour feedback was:\n---\n').concat(tY,"\n---\n\nPlease respond to their question clearly and constructively. Keep your answer concise but helpful. Remember you're speaking directly to the student.");if("gemini-2.5-flash-preview-05-20"===ac){let e={contents:[{parts:[{text:n}]}],generationConfig:{temperature:.7}};aO&&aF>0&&(e.config={thinkingConfig:{thinkingBudget:aF}}),console.log("Sending follow-up to Gemini API:",e);let t=0,a=!1;for(;t<3&&!a;)try{r=await fetch("".concat(eC,"/api/gemini/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(6e4),cache:"no-store"}),a=!0}catch(e){if("AbortError"===e.name||e.message&&e.message.toLowerCase().includes("timeout"))if(t++,console.log("Retrying Gemini API request in handleSubmitFollowUp (".concat(t,"/").concat(3,")...")),t<3)await new Promise(e=>setTimeout(e,1e3));else throw e;else throw e}}else r=ac.startsWith("openai/")||ac.startsWith("xai/")?await fetch("".concat(eC,"/api/github/completions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:ac.startsWith("openai/")||ac.startsWith("xai/")?ac:"xai/grok-3",messages:[{role:"system",content:"You are an AI tutor helping a student understand their GCSE feedback. Be clear, concise, and supportive."},{role:"user",content:n}],max_tokens:aC?void 0:aE,temperature:.7,top_p:1}),signal:AbortSignal.timeout(6e4),cache:"no-store"}):await fetch("".concat(eC,"/api/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:ac,messages:[{role:"system",content:"You are an AI tutor helping a student understand their GCSE feedback. Be clear, concise, and supportive."},{role:"user",content:n}],max_tokens:aC?void 0:aE,temperature:.7}),signal:AbortSignal.timeout(6e4),cache:"no-store"});if(!r.ok){let t=await r.text();console.error("API error response for follow-up:",t);let a="Error processing follow-up question";try{let s=JSON.parse(t);a=(null==(e=s.error)?void 0:e.message)||s.message||t}catch(e){a=t}throw Error(a)}let i=await r.json();console.log("Follow-up response data:",i);let l="";if("gemini-2.5-flash-preview-05-20"===ac){if(i.candidates&&i.candidates[0]&&i.candidates[0].content){let e=i.candidates[0].content;e.parts&&e.parts[0]&&e.parts[0].text&&(l=e.parts[0].text)}}else l=(null==(s=i.choices)||null==(a=s[0])||null==(t=a.message)?void 0:t.content)||i.content||i.text||i.answer||i.response||"";if(!l)throw console.error("Empty or missing response content:",i),Error("Received empty response from API");tD(l)}catch(e){console.error("Error processing follow-up question:",e),"AbortError"===e.name?ef.oR.error("The request timed out. The server took too long to respond."):e.message.includes("rate limit")||e.message.includes("429")?ef.oR.error("Rate limit exceeded. Please try again in a minute or try a different model."):ef.oR.error("Failed to process follow-up: ".concat(e.message)),tD("I'm sorry, I couldn't process your question due to a technical issue. Please try again later or try a different model.")}finally{tW(!1)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,s.jsx)(e=>{let{version:t="2.1.0",backendStatus:a,remainingTokens:r}=e;return(0,s.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between py-2 px-4 border-b border-border bg-card shadow-sm backdrop-blur-sm bg-opacity-90",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"font-semibold text-xl",children:"AI GCSE Marker"}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground hidden sm:block",children:["v",t]}),a&&(0,s.jsxs)("div",{className:"hidden sm:flex items-center space-x-1",children:[(0,s.jsx)("div",{className:"h-2 w-2 rounded-full ".concat("online"===a?"bg-green-500":"rate_limited"===a?"bg-yellow-500":"bg-red-500")}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"online"===a?"API Connected":"rate_limited"===a?"API Rate Limited":"API Offline"})]}),(0,s.jsx)(q.Bc,{children:(0,s.jsxs)(q.m_,{children:[(0,s.jsx)(q.k$,{asChild:!0,children:(0,s.jsxs)("div",{className:"text-xs text-muted-foreground hidden sm:flex items-center",children:[(0,s.jsx)(b.A,{size:12,className:"mr-1"}),(0,s.jsxs)("span",{children:[r," requests left"]})]})}),(0,s.jsx)(q.ZI,{})]})})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(ep.U,{}),(0,s.jsxs)(m.$,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",onClick:()=>e6(!0),children:[(0,s.jsx)(S.A,{size:18}),(0,s.jsx)("span",{className:"sr-only",children:"Keyboard shortcuts"})]}),(0,s.jsxs)(m.$,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",onClick:()=>tL(!tJ),children:[(0,s.jsx)(v.A,{size:18}),(0,s.jsx)("span",{className:"sr-only",children:"Help"})]})]})]})},{version:"2.1.3",backendStatus:ay.current,remainingTokens:aI}),(0,s.jsx)(W,{open:tn,onOpenChange:e=>{e||to(!1),ti(e)},children:(0,s.jsxs)(L,{className:"sm:max-w-[600px]",children:[(0,s.jsxs)(H,{children:[(0,s.jsx)(K,{children:"Review Extracted Text"}),(0,s.jsx)(Q,{children:"Review the text extracted from the image. You can edit it here before adding to your answer."})]}),(0,s.jsx)(ej.F,{className:"h-[300px] w-full rounded-md border p-3 my-4",children:(0,s.jsx)(u.T,{value:ts,onChange:e=>tr(e.target.value),className:"min-h-[280px] text-sm",placeholder:"No text extracted or an error occurred."})}),(0,s.jsxs)(V,{className:"sm:justify-between",children:[(0,s.jsx)(m.$,{variant:"outline",onClick:()=>{ti(!1),to(!1)},children:"Cancel"}),(0,s.jsx)(m.$,{onClick:()=>{ts&&(y(e=>{let t=e.trim()?"\n\n":"";return e+t+ts}),to(!0),ef.oR.success("Text added to answer field.")),ti(!1)},children:"Add to Answer"})]})]})}),(0,s.jsx)(W,{open:tc,onOpenChange:td,children:(0,s.jsxs)(L,{className:"sm:max-w-md",children:[(0,s.jsxs)(H,{children:[(0,s.jsx)(K,{children:"Subject Specific Guidance"}),(0,s.jsxs)(Q,{children:["Guidance for ",null==(e=em.find(e=>e.value===N))?void 0:e.label," - ",null==(t=eT.find(e=>e.value===B))?void 0:t.label]})]}),(0,s.jsx)(ej.F,{className:"h-[300px] w-full rounded-md border p-3 my-4",children:(0,s.jsx)(ez,{children:tm})}),(0,s.jsx)(V,{children:(0,s.jsx)(m.$,{onClick:()=>td(!1),children:"Close"})})]})}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:[tJ&&(0,s.jsx)(eQ,{onClose:()=>tL(!1)}),(0,s.jsx)(eG,{success:t4,error:t1,onRetryAction:{checkBackendStatus:th}}),t5&&!ak.current&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-primary/10 border border-primary/20 rounded-md flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(g.A,{className:"h-5 w-5 text-primary mr-2"}),(0,s.jsxs)("span",{className:"text-sm text-primary",children:["Subject detected: ",(0,s.jsx)("strong",{children:(null==(a=em.find(e=>e.value===t5))?void 0:a.label)||"Unknown"})]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(m.$,{variant:"outline",size:"sm",className:"text-xs h-7 border-primary/20 hover:bg-primary/10",onClick:()=>{I(t5),ak.current=!0,t6(null)},children:"Accept"}),(0,s.jsx)(m.$,{variant:"ghost",size:"sm",className:"text-xs h-7 text-muted-foreground",onClick:()=>t6(null),children:"Dismiss"})]})]}),(0,s.jsx)(i.N,{children:t8&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},className:"fixed top-4 right-4 bg-background border border-border shadow-md text-foreground px-3 py-2 rounded-md z-50 text-sm",children:t8})}),(0,s.jsx)(Y,{open:e5,onOpenChange:e6}),(0,s.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:(0,s.jsx)("div",{className:"lg:col-span-12 space-y-4",children:(0,s.jsxs)(O.tU,{value:es,onValueChange:er,className:"w-full",children:[(0,s.jsxs)(O.j7,{className:"grid w-full grid-cols-3",children:[" ",(0,s.jsx)(O.Xi,{value:"answer",children:"Answer"}),(0,s.jsx)(O.Xi,{value:"feedback",children:"Feedback"}),(0,s.jsxs)(O.Xi,{value:"bulk",children:["Bulk Mark",(0,s.jsx)(_.E,{variant:"outline",className:"ml-2 text-amber-600 border-amber-400 bg-amber-50 dark:bg-amber-900/30 text-xs font-semibold",children:"Very Beta"})]})," "]}),(0,s.jsxs)(O.av,{value:"answer",className:"pt-4 space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(eh.J,{htmlFor:"question",className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:"Question"}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs ml-1",children:"(Required)"})]}),(0,s.jsx)(_.E,{variant:"outline",className:"font-normal text-xs",children:"GCSE Level"})]}),(0,s.jsx)(u.T,{id:"question",placeholder:"Enter the question here...",className:"min-h-[60px]",value:o,onChange:e=>c(e.target.value),ref:af})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(eh.J,{htmlFor:"answer",children:[(0,s.jsx)("span",{children:"Your Answer"}),(0,s.jsx)("span",{className:"text-muted-foreground text-xs ml-1",children:"(Required)"})]}),(0,s.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>document.getElementById("image-upload").click(),className:"text-xs h-7 ml-2",disabled:ah,children:ah?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.A,{className:"mr-1 h-3 w-3 animate-spin"})," Processing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.A,{className:"mr-1 h-3 w-3"})," Upload Image"]})})]}),(0,s.jsx)("input",{type:"file",id:"image-upload",accept:"image/*",className:"hidden",onChange:e=>{e.target.files&&e.target.files[0]&&(et(e.target.files[0]),tr(""),to(!1))},disabled:ah}),(0,s.jsx)(u.T,{id:"answer",placeholder:"Enter your answer here...",className:"min-h-[150px]",value:w,onChange:e=>y(e.target.value),ref:ab}),ee&&!ah&&(0,s.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,s.jsxs)(_.E,{variant:"outline",className:"text-xs",children:[ee.name," (",Math.round(ee.size/1024)," KB)"]}),(0,s.jsx)(m.$,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 ml-2",onClick:()=>et(null),children:(0,s.jsx)(k.A,{className:"h-4 w-4"})}),(0,s.jsx)(m.$,{size:"sm",variant:"outline",className:"text-xs h-7 ml-2",onClick:t$,children:"Process Image"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(eh.J,{htmlFor:"subject",className:"text-sm",children:"Subject"}),(0,s.jsxs)(m.$,{variant:"link",size:"sm",className:"text-xs h-7 px-1 text-muted-foreground hover:text-primary",onClick:()=>{tu((0,d.$G)(N,B)||"No specific guidance available for the current selection."),td(!0)},tabIndex:-1,children:[(0,s.jsx)(v.A,{className:"mr-1 h-3 w-3"})," View Guidance"]})]}),(0,s.jsxs)(x.l6,{value:N,onValueChange:e=>{if("custom"===e)return void eo(!0);I(e),ak.current=!0,z("general")},children:[(0,s.jsx)(x.bq,{children:(0,s.jsx)(x.yv,{placeholder:"Select a subject"})}),(0,s.jsx)(x.gC,{children:(0,s.jsxs)(x.s3,{children:[(0,s.jsx)(x.TR,{children:"Common Subjects"}),em.map(e=>(0,s.jsx)(x.eb,{value:e.value,children:e.label},e.value)),(0,s.jsx)(x.eb,{value:"custom",className:"text-primary",children:"+ Add Custom Subject"})]})})]}),el&&(0,s.jsxs)("div",{className:"mt-2 flex",children:[(0,s.jsx)(ex.p,{ref:ew,value:en,onChange:e=>ei(e.target.value),placeholder:"Enter subject name",className:"text-sm"}),(0,s.jsx)(m.$,{size:"sm",className:"ml-2 px-2",onClick:()=>{if(!en.trim())return;let e=en.toLowerCase().replace(/\s+/g,""),t={value:e,label:en.trim()};ed(e=>[...e,t]),eu(e=>[...e,t]),I(e),ak.current=!0,ei(""),eo(!1),setTimeout(()=>{ew.current&&ew.current.blur()},10)},disabled:!en.trim(),children:"Add"}),(0,s.jsx)(m.$,{size:"sm",variant:"ghost",className:"ml-1 px-2",onClick:()=>eo(!1),children:(0,s.jsx)(k.A,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)(eh.J,{htmlFor:"examBoard",className:"text-sm",children:"Exam Board"})}),(0,s.jsxs)(x.l6,{value:B,onValueChange:G,children:[(0,s.jsx)(x.bq,{children:(0,s.jsx)(x.yv,{placeholder:"Select an exam board"})}),(0,s.jsx)(x.gC,{children:eT.map(e=>(0,s.jsx)(x.eb,{value:e.value,children:e.label},e.value))})]})]}),(null==(l=em.find(e=>e.value===N))?void 0:l.hasTiers)&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.J,{className:"text-sm",children:"Tier"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(m.$,{variant:"higher"===e7?"default":"outline",size:"sm",className:"flex-1",onClick:()=>te("higher"),children:"Higher"}),(0,s.jsx)(m.$,{variant:"foundation"===e7?"default":"outline",size:"sm",className:"flex-1",onClick:()=>te("foundation"),children:"Foundation"})]})]}),"english"===N&&"aqa"===B&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.J,{htmlFor:"questionType",className:"text-sm",children:"Question Type"}),(0,s.jsxs)(x.l6,{value:D,onValueChange:z,children:[(0,s.jsx)(x.bq,{children:(0,s.jsx)(x.yv,{placeholder:"Select question type"})}),(0,s.jsx)(x.gC,{children:eB.english.aqa.map(e=>(0,s.jsx)(x.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.J,{htmlFor:"userType",className:"text-sm",children:"I am a"}),(0,s.jsxs)(x.l6,{value:$,onValueChange:J,children:[(0,s.jsx)(x.bq,{children:(0,s.jsx)(x.yv,{placeholder:"Select user type"})}),(0,s.jsx)(x.gC,{children:eI.map(e=>(0,s.jsx)(x.eb,{value:e.value,children:e.label},e.value))})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>tV(!tH),className:"text-xs",children:[tH?(0,s.jsx)(C.A,{className:"mr-1 h-3 w-3"}):(0,s.jsx)(R.A,{className:"mr-1 h-3 w-3"}),"Advanced Options"]}),tH&&(0,s.jsxs)("div",{className:"mt-3 space-y-4 border p-4 rounded-md bg-muted border-border",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(eh.J,{htmlFor:"markScheme",className:"text-sm",children:["Mark Scheme ",(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-0.5",children:"Adding a mark scheme will enhance feedback with detailed criteria analysis"})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)(m.$,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:aH,disabled:tK||!o||"online"!==ay.current,ref:aw,children:[tK?(0,s.jsx)(j.A,{className:"mr-1 h-3 w-3 animate-spin"}):(0,s.jsx)(E.A,{className:"mr-1 h-3 w-3"}),"Generate"]})})]}),(0,s.jsx)(u.T,{id:"markScheme",placeholder:"Enter mark scheme details...",className:"min-h-[100px]",value:Z,onChange:e=>X(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(eh.J,{htmlFor:"totalMarks",className:"text-sm",children:["Total Marks ",(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,s.jsx)(ex.p,{id:"totalMarks",type:"number",placeholder:"e.g., 20",value:ek,onChange:e=>eN(e.target.value),className:"max-w-[120px]",ref:aj}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:'If not provided, system will attempt to detect total marks from the question (like "8 marks" or "[Total: 10]").'})]}),"english"===N&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(eh.J,{htmlFor:"textExtract",className:"text-sm",children:["Text Extract ",(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,s.jsx)(u.T,{id:"textExtract",placeholder:"Enter any text extract the question refers to...",className:"min-h-[100px]",value:eD,onChange:e=>eW(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(eh.J,{htmlFor:"relevantMaterial",className:"text-sm",children:["Relevant Material ",(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,s.jsx)(u.T,{id:"relevantMaterial",placeholder:"Enter any additional context, notes or material...",className:"min-h-[100px]",value:e$,onChange:e=>eJ(e.target.value)}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Add image as relevant material"}),"gemini-2.5-flash-preview-05-20"!==ac&&(0,s.jsx)(_.E,{variant:"outline",className:"text-xs text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800/50",children:"Only works with Gemini 2.5 Flash"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>document.getElementById("relevant-material-image").click(),className:"text-xs h-7",disabled:"gemini-2.5-flash-preview-05-20"!==ac||e1,children:e1?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.A,{className:"mr-1 h-3 w-3 animate-spin"})," Processing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.A,{className:"mr-1 h-3 w-3"})," Upload Image"]})}),"gemini-2.5-flash-preview-05-20"!==ac&&(0,s.jsx)(m.$,{variant:"link",size:"sm",className:"text-xs h-7 text-amber-600 dark:text-amber-400 px-0",onClick:()=>{ad("gemini-2.5-flash-preview-05-20"),to(!0)},children:"Switch to Gemini 2.5 Flash"})]}),(0,s.jsx)("input",{type:"file",id:"relevant-material-image",accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];eH(t),e2(!0);let a=new FileReader;a.onloadend=()=>{e0(a.result.split(",")[1]),e2(!1),ef.oR.success("Image added as relevant material")},a.onerror=()=>{e2(!1),ef.oR.error("Failed to process image")},a.readAsDataURL(t)}},disabled:"gemini-2.5-flash-preview-05-20"!==ac||e1}),eL&&(0,s.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,s.jsxs)(_.E,{variant:"outline",className:"text-xs",children:[eL.name," (",Math.round(eL.size/1024)," KB)"]}),(0,s.jsx)(m.$,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 ml-2",onClick:()=>eH(null),children:(0,s.jsx)(k.A,{className:"h-4 w-4"})})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(eh.J,{htmlFor:"aiModel",className:"text-sm",children:["AI Model ",(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),(0,s.jsxs)(x.l6,{value:ac,onValueChange:e=>{if(e===ac)return;let t=Date.now(),a=eM[e]||1e4,s=t-(am[e]||0);if(ad(e),s<a){var r;let t=Math.ceil((a-s)/1e3);ef.oR.warning("".concat((null==(r=eP.find(t=>t.value===e))?void 0:r.label)||e," was used recently. Actual use might be rate-limited for ").concat(t," more seconds."))}},disabled:tz,children:[(0,s.jsx)(x.bq,{children:(0,s.jsx)(x.yv,{placeholder:"Select AI model"})}),(0,s.jsx)(x.gC,{children:eP.map(e=>(0,s.jsx)(x.eb,{value:e.value,className:"py-2",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]})},e.value))})]}),"gemini-2.5-flash-preview-05-20"===ac&&tl&&(0,s.jsxs)("div",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1 flex items-center",children:[(0,s.jsx)(p.A,{className:"h-3 w-3 mr-1"}),(0,s.jsx)("span",{children:"Uses direct Gemini API with custom key, may need backend updates"})]})]}),(0,s.jsx)("div",{className:"space-y-2 pt-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(eh.J,{htmlFor:"autoMaxTokens",className:"text-sm flex items-center",children:["Automatic Max Tokens",(0,s.jsx)(q.Bc,{children:(0,s.jsxs)(q.m_,{children:[(0,s.jsx)(q.k$,{asChild:!0,children:(0,s.jsx)(v.A,{className:"h-3 w-3 ml-1.5 text-muted-foreground cursor-help"})}),(0,s.jsx)(q.ZI,{side:"top",className:"max-w-xs",children:(0,s.jsx)("p",{children:"When enabled, the AI will automatically determine the appropriate maximum number of tokens for the response. Disable to set a custom limit."})})]})})]}),(0,s.jsx)(ey,{id:"autoMaxTokens",checked:aC,onCheckedChange:aR})]})}),!aC&&(0,s.jsxs)("div",{className:"space-y-2 mt-3",children:[(0,s.jsxs)(eh.J,{htmlFor:"maxTokensSlider",className:"text-sm",children:["Max Tokens: ",aE]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(ev,{id:"maxTokensSlider",min:256,max:8192,step:128,value:[aE],onValueChange:e=>aT(e[0]),className:"flex-grow"}),(0,s.jsx)(ex.p,{id:"maxTokensInput",type:"number",value:aE,onChange:e=>{let t=parseInt(e.target.value);isNaN(t)?""===e.target.value&&aT(256):t>=256&&t<=8192?aT(t):t<256?aT(256):t>8192&&aT(8192)},className:"w-24 text-sm h-9",min:256,max:8192,step:128})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Defines the maximum length of the AI's response. (Min: 256, Max: 8192). Default is 2048."})]}),"gemini-2.5-flash-preview-05-20"===ac&&(0,s.jsxs)("div",{className:"space-y-2 pt-2 border-t border-border mt-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(eh.J,{htmlFor:"enableThinkingBudget",className:"text-sm flex items-center",children:["Enable Thinking Budget",(0,s.jsx)(q.Bc,{children:(0,s.jsxs)(q.m_,{children:[(0,s.jsx)(q.k$,{asChild:!0,children:(0,s.jsx)(v.A,{className:"h-3 w-3 ml-1.5 text-muted-foreground cursor-help"})}),(0,s.jsx)(q.ZI,{side:"top",className:"max-w-xs",children:(0,s.jsx)("p",{children:"When enabled, the model will use a thinking budget to solve more complex tasks. This may improve answer quality but might increase response time."})})]})})]}),(0,s.jsx)(ey,{id:"enableThinkingBudget",checked:aO,onCheckedChange:e=>{aq(e)}})]}),aO&&(0,s.jsxs)("div",{className:"space-y-2 mt-3",children:[(0,s.jsxs)(eh.J,{htmlFor:"thinkingBudgetSlider",className:"text-sm",children:["Thinking Budget: ",aF]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(ev,{id:"thinkingBudgetSlider",min:512,max:24576,step:512,value:[aF],onValueChange:e=>aM(e[0]),className:"flex-grow"}),(0,s.jsx)(ex.p,{id:"thinkingBudgetInput",type:"number",value:aF,onChange:e=>{let t=parseInt(e.target.value);isNaN(t)?""===e.target.value&&aM(0):t>=0&&t<=24576?aM(t):t<0?aM(0):t>24576&&aM(24576)},className:"w-24 text-sm h-9",min:0,max:24576,step:512})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Defines the maximum tokens used for thinking. Higher values may improve quality for complex tasks. (Min: 0, Max: 24576)"})]})]},"thinking-budget-controls")]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m.$,{ref:av,onClick:aL,disabled:tK||!w||"online"!==ay.current,className:"w-full",children:tK?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"online"!==ay.current?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.A,{className:"mr-2 h-4 w-4"}),"Wake up API first"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"Mark Answer"]})}),(0,s.jsx)("div",{className:"flex justify-between",children:(0,s.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>{c(""),y(""),X(""),et(null),eW(""),eJ(""),eH(null),e0(null),eN(""),tZ(""),t0(""),ta(null),t2(null),t3(null),localStorage.removeItem(eY.QUESTION),localStorage.removeItem(eY.ANSWER),ef.oR.success("Form has been reset and drafts cleared")},className:"text-xs",disabled:tK,children:[(0,s.jsx)(f.A,{className:"mr-1 h-3 w-3"}),"Reset Form"]})})]})]}),(0,s.jsx)(O.av,{value:"feedback",className:"pt-4 relative",children:(0,s.jsx)(eK,{loading:tK,feedback:tY,grade:tX,selectedModel:ac,modelThinking:e4,achievedMarks:tt,totalMarks:ek,processingProgress:t7,setActiveTab:er,markScheme:Z,onAskFollowUp:()=>{if(t_(!0),tU(""),tD(""),"microsoft/mai-ds-r1:free"===ac){let e="gemini-2.5-flash-preview-05-20";console.log("Temporarily switching from ".concat(ac," to ").concat(e," for follow-up")),ad(e)}},followUpEnabled:!!tY&&"online"===ay.current})}),(0,s.jsxs)(O.av,{value:"bulk",className:"pt-4 space-y-6",children:[(0,s.jsxs)(h.Zp,{children:[(0,s.jsxs)(h.aR,{children:[(0,s.jsx)(h.ZB,{children:"Bulk Assessment Processing"}),(0,s.jsx)(h.BT,{children:"Upload a file containing multiple questions and answers to mark in bulk. Supported formats: CSV, JSON, and TXT files."})]}),(0,s.jsxs)(h.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.J,{htmlFor:"bulk-file-upload",children:"Upload File"}),(0,s.jsx)(ex.p,{id:"bulk-file-upload",type:"file",accept:".csv,.json,.txt",onChange:e=>{let t=e.target.files[0];t&&(tg(t),t.name.split(".").pop().toLowerCase(),ef.oR.info('File "'.concat(t.name,'" selected. Ready to process.')),tf([]),tj([]))},ref:tA,disabled:tw}),tx&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Selected file: ",tx.name]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,s.jsx)("strong",{children:"Format requirements:"}),(0,s.jsx)("br",{}),"- CSV: Include 'Question' and 'Answer' columns",(0,s.jsx)("br",{}),"- JSON: Array of objects with 'question' and 'answer' properties",(0,s.jsx)("br",{}),"- TXT: One item per line with question and answer separated by tab or comma"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.J,{children:"Settings Preference"}),(0,s.jsxs)(x.l6,{value:tk,onValueChange:ty,disabled:tw,children:[(0,s.jsx)(x.bq,{className:"w-[280px]",children:(0,s.jsx)(x.yv,{placeholder:"Choose settings source"})}),(0,s.jsxs)(x.gC,{children:[(0,s.jsx)(x.eb,{value:"global",children:"Use Global Settings (from Answer tab)"}),(0,s.jsx)(x.eb,{value:"file",children:"Use Settings from File (if available)"})]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"If 'Use Settings from File' is chosen and a setting is missing for an item, global settings will be used as a fallback."})]}),tw&&tN.total>0&&(0,s.jsx)(eX,{isProcessing:tw,progress:tN,onPause:()=>{tF.current.pause=!0,tP(!0),ef.oR.info("Bulk processing paused. Will complete current item before stopping.")},onResume:()=>{tF.current.pause=!1,tP(!1),ef.oR.info("Bulk processing resumed.")},onCancel:()=>{tF.current.cancel=!0,tF.current.pause=!1,ef.oR.info("Cancelling bulk processing after current item completes...")},isPaused:tI,parallelism:tM,onParallelismChange:e=>{tO(e),ef.oR.info("Parallel processing set to ".concat(e," simultaneous tasks"))}}),!tw&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eh.J,{htmlFor:"parallelism-setting",className:"text-sm whitespace-nowrap",children:"Parallel Processing:"}),(0,s.jsxs)(x.l6,{id:"parallelism-setting",value:tM.toString(),onValueChange:e=>tO(parseInt(e)),children:[(0,s.jsx)(x.bq,{className:"w-24",children:(0,s.jsx)(x.yv,{placeholder:tM})}),(0,s.jsxs)(x.gC,{children:[(0,s.jsx)(x.eb,{value:"1",children:"1 task"}),(0,s.jsx)(x.eb,{value:"2",children:"2 tasks"}),(0,s.jsx)(x.eb,{value:"3",children:"3 tasks"}),(0,s.jsx)(x.eb,{value:"4",children:"4 tasks"})]})]}),(0,s.jsx)(q.Bc,{children:(0,s.jsxs)(q.m_,{children:[(0,s.jsx)(q.k$,{asChild:!0,children:(0,s.jsx)(v.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,s.jsx)(q.ZI,{side:"right",className:"max-w-xs",children:(0,s.jsx)("p",{children:"Process multiple items simultaneously to speed up bulk marking. Higher values may increase API rate limiting."})})]})})]}),(0,s.jsx)(m.$,{onClick:aK,disabled:!tx||tw||"online"!==ay.current,className:"w-full sm:w-auto",children:tw?(0,s.jsxs)(r.Fragment,{children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),tI?"Paused":"Processing (".concat(tN.processed,"/").concat(tN.total,")...")]}):"online"!==ay.current?(0,s.jsxs)(r.Fragment,{children:[(0,s.jsx)(p.A,{className:"mr-2 h-4 w-4"})," API Offline"]}):(0,s.jsxs)(r.Fragment,{children:[(0,s.jsx)(eb.A,{className:"mr-2 h-4 w-4"})," Process File"]})})]})]}),(tw||tb.length>0)&&(0,s.jsxs)(h.Zp,{children:[(0,s.jsxs)(h.aR,{children:[(0,s.jsx)(h.ZB,{children:"Bulk Results"}),tw&&tN.total>0&&(0,s.jsxs)(h.BT,{children:["Processing item ",tN.currentItem||"-"," of ",tN.total,". Processed: ",tN.processed,"."]})]}),(0,s.jsxs)(h.Wu,{children:[0===tb.length&&tw&&(0,s.jsxs)("div",{className:"flex items-center justify-center p-6 text-muted-foreground",children:[(0,s.jsx)(j.A,{className:"mr-2 h-5 w-5 animate-spin"}),(0,s.jsx)("span",{children:"Waiting for results..."})]}),tb.length>0&&(0,s.jsxs)(ej.F,{className:"h-[400px] w-full",children:[(0,s.jsx)("div",{className:"space-y-4 pr-4",children:tb.map((e,t)=>(0,s.jsxs)("div",{className:"p-3 border rounded-md bg-muted/30",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,s.jsxs)("h4",{className:"font-semibold text-sm",children:["Item ",e.itemIndex+1,": ",e.question?e.question.substring(0,100)+(e.question.length>100?"...":""):"N/A"]}),e.grade&&(0,s.jsx)("div",{className:"inline-flex items-center justify-center h-6 w-6 bg-gradient-to-br from-indigo-600 to-purple-600 dark:from-indigo-500 dark:to-purple-500 text-white font-bold rounded-full text-xs shadow-sm",children:e.grade})]}),e.error?(0,s.jsxs)(P,{variant:"destructive",className:"py-2 px-3",children:[(0,s.jsx)(p.A,{className:"h-4 w-4"}),(0,s.jsx)(F,{className:"text-xs",children:"Error"}),(0,s.jsx)(M,{className:"text-xs",children:e.error})]}):(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsxs)("p",{className:"mt-1",children:[(0,s.jsx)("strong",{children:"Feedback Summary:"})," ",e.feedback?e.feedback.substring(0,150)+(e.feedback.length>150?"...":""):"N/A"]}),(0,s.jsxs)(m.$,{variant:"link",size:"sm",className:"p-0 h-auto mt-1 text-xs",onClick:()=>aQ(e),children:[(0,s.jsx)(T.A,{className:"h-3 w-3 mr-1"}),"View Full Details"]})]})]},t))}),(0,s.jsx)(ej.$,{orientation:"vertical"})]})]}),tb.length>0&&(0,s.jsxs)(h.wL,{className:"flex justify-between",children:[(0,s.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>tj([]),disabled:tw,children:[(0,s.jsx)(k.A,{className:"h-4 w-4 mr-1"})," Clear Results"]}),(0,s.jsxs)(m.$,{size:"sm",onClick:()=>{let e=new Blob([["Item,Question,Answer,Grade,Marks,Total Marks,Feedback",...tb.map((e,t)=>{var a,s,r,n;return[t+1,'"'.concat((null==(a=e.question)?void 0:a.replace(/"/g,'""'))||"",'"'),'"'.concat((null==(s=e.answer)?void 0:s.replace(/"/g,'""'))||"",'"'),e.grade||"N/A",e.achievedMarks||"",e.totalMarks||"",'"'.concat((null==(r=e.feedback)?void 0:r.replace(/"/g,'""'))||(null==(n=e.error)?void 0:n.replace(/"/g,'""'))||"",'"')].join(",")})].join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download","bulk-results-".concat(new Date().toISOString().split("T")[0],".csv")),document.body.appendChild(a),a.click(),document.body.removeChild(a),ef.oR.success("Results downloaded as CSV file")},disabled:tw||0===tb.length,children:[(0,s.jsx)(ea.A,{className:"h-4 w-4 mr-1"})," Download Results"]})]})]})]})]})})})]}),(0,s.jsx)(eZ,{open:tE,onOpenChange:tT,item:tC,onClose:()=>tT(!1)}),(0,s.jsx)(W,{open:tq,onOpenChange:t_,children:(0,s.jsxs)(L,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[(0,s.jsxs)(H,{children:[(0,s.jsx)(K,{children:"Ask a Follow-Up Question"}),(0,s.jsx)(Q,{children:"Need clarification about your feedback? Ask the AI for more help."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.J,{htmlFor:"follow-up-question",children:"Your Question"}),(0,s.jsx)(u.T,{id:"follow-up-question",placeholder:"e.g., Can you explain more about why I lost marks on the first point? What would a better answer look like?",value:tB,onChange:e=>tU(e.target.value),className:"min-h-[100px]",disabled:tz})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.J,{htmlFor:"follow-up-model",children:"Model to use"}),(0,s.jsxs)(x.l6,{value:ac,onValueChange:e=>{if(e===ac)return;let t=Date.now(),a=eM[e]||1e4;t-(am[e]||0)<a&&ef.oR.warning("Model was used recently. Switching anyway, but response may be delayed."),ad(e),aM(eq[e]||1024)},disabled:tz,children:[(0,s.jsx)(x.bq,{id:"follow-up-model",className:"w-full",children:(0,s.jsx)(x.yv,{placeholder:"Select AI model"})}),(0,s.jsx)(x.gC,{children:eP.map(e=>(0,s.jsx)(x.eb,{value:e.value,className:"py-2",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]})},e.value))})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"If one model isn't responding, try another model for this follow-up."})]}),tG&&(0,s.jsxs)("div",{className:"space-y-2 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsx)(eh.J,{children:"AI Response"}),(0,s.jsx)("div",{className:"p-4 rounded-md bg-muted/30 border border-border min-h-[100px]",children:(0,s.jsx)(ez,{children:tG})})]})]}),(0,s.jsxs)(V,{className:"flex flex-col sm:flex-row gap-2 justify-between sm:justify-end",children:[tz&&(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground text-sm",children:[(0,s.jsx)(j.A,{className:"animate-spin h-4 w-4 mr-2"}),"Processing your question..."]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(m.$,{variant:"outline",onClick:()=>t_(!1),disabled:tz,children:"Close"}),!tG&&(0,s.jsx)(m.$,{onClick:aY,disabled:tz||!tB.trim(),children:tz?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.A,{className:"animate-spin h-4 w-4 mr-2"}),"Submitting..."]}):"Get Answer"}),tG&&!tz&&(0,s.jsx)(m.$,{onClick:()=>{tU(""),tD("")},children:"Ask Another Question"})]})]})]})})]})}},86653:(e,t,a)=>{a.d(t,{Q:()=>l,h:()=>i});var s=a(12115),r=a(54052),n=a.n(r);let i=(e,t)=>{let a=(0,s.useCallback)(async t=>{if(!t||t.length<20)return null;try{for(let[a,s]of Object.entries(e))for(let e of s)if(t.toLowerCase().includes(e.toLowerCase()))return a;return null}catch(e){return console.error("Subject classification error:",e),null}},[e]),r=(0,s.useRef)(null);return(0,s.useEffect)(()=>(r.current=n()(async(e,s,r,n,i,l,o)=>{if(t)return;let c=await a(e);if(c&&c!==s&&!r.current){var d,m;let e=(null==(d=n.find(e=>e.value===s))?void 0:d.label)||"",t=(null==(m=n.find(e=>e.value===c))?void 0:m.label)||"";i(c),l(c),o({message:"Subject automatically detected as ".concat(t),detail:e?"Changed from ".concat(e):null,icon:"detection"}),setTimeout(()=>o(null),3e3)}},1e3),()=>{r.current&&r.current.cancel()}),[a,t,e]),{classifySubjectAI:a,debouncedClassifySubject:(0,s.useCallback)(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];if(r.current)return r.current(...t)},[])}},l=e=>({checkBackendStatus:(0,s.useCallback)(async t=>{try{if(window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname){console.log("Running on GitHub Pages - simulating online status for UI rendering");try{window.localStorage.setItem("USE_LOCAL_API","true")}catch(e){console.warn("Failed to set up local API fallbacks:",e)}return window.BACKEND_STATUS={status:"online",lastChecked:new Date().toLocaleTimeString(),isGitHubPages:!0,usingLocalFallbacks:!0},{ok:!0,data:{status:"ok",openaiClient:!0,apiKeyConfigured:!0,isGitHubPages:!0,usingLocalFallbacks:!0},status:"online"}}let a=0;for(;a<=3;)try{let a=new AbortController,s=setTimeout(()=>a.abort(),12e3),r=window.location.hostname.includes("github.io")||"beenycool.github.io"===window.location.hostname?"".concat(e,"/health"):window.constructApiUrl?window.constructApiUrl("health"):"".concat(e,"/api/health");console.log("Checking backend health at ".concat(r));let n=await fetch("".concat(r,"?timestamp=").concat(Date.now()),{method:"GET",signal:a.signal,mode:"cors",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(clearTimeout(s),!n.ok){if(404===n.status)return console.warn("Backend health check returned 404. Simulating success for UI rendering."),{ok:!0,data:{status:"ok",openaiClient:!0,apiKeyConfigured:!0,simulated404:!0},status:"online"};throw Error("Backend health check failed: ".concat(n.status))}let i=await n.json();if(console.log("Backend health check data:",i),!0!==i.openaiClient||!0!==i.apiKeyConfigured)return{ok:!1,error:"The backend API service is not properly configured. Please try again later.",status:"error",data:i};if(t&&"gemini-2.5-flash-preview-05-20"===t&&!0===i.rateLimited)return{ok:!1,error:"Gemini 2.5 Flash Preview is rate limited. Please try again in a minute or choose another model.",status:"rate_limited",data:i};return{ok:!0,data:i,status:"online"}}catch(t){if(3===a)throw t;let e=2e3*(a+1);console.log("Retry attempt ".concat(a+1," for backend health check in ").concat(e,"ms")),await new Promise(t=>setTimeout(t,e)),a++}}catch(a){console.error("Backend health check failed:",a);let e=a.message,t="error";return"AbortError"===a.name||"TimeoutError"===a.name?e="Backend did not respond in time. The server may take up to 50 seconds to wake up.":(a.message.includes("Failed to fetch")||a.message.includes("NetworkError"))&&(e="Network connection to backend failed. Please check your internet connection and try again in a moment.",t="network"),{ok:!1,error:e,status:t}}},[e])})}}]);